<!doctype html><html lang=en-us style=max-width:1000px;margin:auto><head><title>Kevin Blog</title><meta name=theme-color content><meta charset=utf-8><meta content="width=device-width,initial-scale=1" name=viewport><meta name=description content="Kevin learning"><meta name=author content="Kevin Chen"><meta name=generator content="aafu theme by Darshan in Hugo 0.83.0"><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/safari-pinned-tab.svg color=#252627><link rel="shortcut icon" href=/favicon.ico><link rel=stylesheet href=/css/bootstrap/bootstrap.min.css><link rel=stylesheet href=https://use.fontawesome.com/releases/v5.15.2/css/all.css integrity=sha384-vSIIfh2YWi9wW0r9iZe7RJPrKwp6bG+s9QZMoITbCckVJqGCCRhc+ccxNcdpHuYu crossorigin=anonymous><link rel=stylesheet href=https://cdn.rawgit.com/jpswalsh/academicons/master/css/academicons.min.css><link rel=stylesheet href="//fonts.googleapis.com/css?family=Didact+Gothic%7CRoboto:400%7CRoboto+Mono"><link rel=stylesheet href=/css/aafu_pinkish.css><link rel=stylesheet href=/css/aafu.css><script>var themeColor=document.querySelector("meta[name=theme-color]");window.onload=()=>{themeColor.content=getComputedStyle(document.body)["background-color"];let a=document.querySelector(".accordion.active");a&&(a.nextElementSibling.style.maxHeight=a.nextElementSibling.scrollHeight+"px")},window.onresize=()=>{let a=document.querySelector(".accordion.active");a&&(a.nextElementSibling.style.maxHeight=a.nextElementSibling.scrollHeight+"px")}</script></head><body class=container><main style="min-height:calc(100vh - 60px)"><div class="d-flex flex-row row p-2"><h3 class="main-menu mr-3"><a href=https://cch0124.github.io/>Home</a></h3><h3 class="main-menu mr-3"><a href=/blog>Blog</a></h3><h3 class="main-menu mr-3"><a href=/project>Project</a></h3><h3 class="main-menu mr-3"><a href=/life>Life</a></h3><h3 class="main-menu mr-3"><a href=/kubernetes>Kubernetes</a></h3><h3 class="main-menu mr-3"><a href=/code>Coding</a></h3></div><div class=mb-3><h1 class=top-h1 style=font-size:2.75em>Spring security 概觀</h1><p class=mb-1>October 28, 2021</p><p>&mdash;</p></div><div class=content><p>在 Spring Security 主要核心功能是 <code>Authentication</code>(使用者認證) 和 <code>Authorization</code>(使用者授權)兩部份。</p><ol><li>Authentication
使用者是否能訪問該系統，一般都是透過帳號和密碼進行確認。</li><li>Authorization
用戶是否有權限執行某個操作，也就是系統上會有很多角色分配給使用者，而這些使用者能操作的動作就對應到角色。</li></ol><h2 id=演示>演示</h2><ol><li>pom.xml</li></ol><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml>...
        <span style=color:#f92672>&lt;dependency&gt;</span>
			<span style=color:#f92672>&lt;groupId&gt;</span>org.springframework.boot<span style=color:#f92672>&lt;/groupId&gt;</span>
			<span style=color:#f92672>&lt;artifactId&gt;</span>spring-boot-starter-security<span style=color:#f92672>&lt;/artifactId&gt;</span>
		<span style=color:#f92672>&lt;/dependency&gt;</span>
		<span style=color:#f92672>&lt;dependency&gt;</span>
			<span style=color:#f92672>&lt;groupId&gt;</span>org.springframework.boot<span style=color:#f92672>&lt;/groupId&gt;</span>
			<span style=color:#f92672>&lt;artifactId&gt;</span>spring-boot-starter-web<span style=color:#f92672>&lt;/artifactId&gt;</span>
		<span style=color:#f92672>&lt;/dependency&gt;</span>
...
</code></pre></div><ol start=2><li>撰寫一個 controller</li></ol><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#a6e22e>@RestController</span>
<span style=color:#a6e22e>@RequestMapping</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;/api/v1&#34;</span><span style=color:#f92672>)</span>
<span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>TestController</span> <span style=color:#f92672>{</span>
    <span style=color:#a6e22e>@GetMapping</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;/hello&#34;</span><span style=color:#f92672>)</span>
    <span style=color:#66d9ef>public</span> String <span style=color:#a6e22e>hello</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
        <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#34;Hello Security&#34;</span><span style=color:#f92672>;</span>
    <span style=color:#f92672>}</span>
<span style=color:#f92672>}</span>
</code></pre></div><ol start=3><li>對設計的 controller 進行請求
會發現會被導到一個登入頁面，這也可以表示 Spring Security 有被啟用。</li></ol><p><img src=https://i.imgur.com/f9qe0CR.png alt>
預設的使用者是 <code>user</code> 密碼則會是在 <code>console</code> 中以 <code>Using generated security password: d7ce1ace-a637-4896-8556-a531dedbab29</code> 呈現。登入後即可呈現我們所請求的內容。</p><h2 id=基本原理>基本原理</h2><p>Spring Security 和 iptable 一樣都是一串鏈連接起來的。下面會介紹較為重要的過濾器</p><h3 id=filtersecurityinterceptor>FilterSecurityInterceptor</h3><p>是一個方法級別的權限過濾器，基本上是鏈的最底部。
<code>FilterSecurityInterceptor</code> 實作了 <code>Filter</code>，其中包括以下方法</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java>    <span style=color:#a6e22e>@Override</span>
	<span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>init</span><span style=color:#f92672>(</span>FilterConfig arg0<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
	<span style=color:#f92672>}</span>

	<span style=color:#75715e>/**
</span><span style=color:#75715e>	 * Not used (we rely on IoC container lifecycle services instead)
</span><span style=color:#75715e>	 */</span>
	<span style=color:#a6e22e>@Override</span>
	<span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>destroy</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
	<span style=color:#f92672>}</span>

    <span style=color:#a6e22e>@Override</span>
	<span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>doFilter</span><span style=color:#f92672>(</span>ServletRequest request<span style=color:#f92672>,</span> ServletResponse response<span style=color:#f92672>,</span> FilterChain chain<span style=color:#f92672>)</span>
			<span style=color:#66d9ef>throws</span> IOException<span style=color:#f92672>,</span> ServletException <span style=color:#f92672>{</span>
            invoke<span style=color:#f92672>(</span><span style=color:#66d9ef>new</span> FilterInvocation<span style=color:#f92672>(</span>request<span style=color:#f92672>,</span> response<span style=color:#f92672>,</span> chain<span style=color:#f92672>));</span>
	<span style=color:#f92672>}</span>
</code></pre></div><p>在 <code>invoke</code> 方法中</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>invoke</span><span style=color:#f92672>(</span>FilterInvocation filterInvocation<span style=color:#f92672>)</span> <span style=color:#66d9ef>throws</span> IOException<span style=color:#f92672>,</span> ServletException <span style=color:#f92672>{</span>
		<span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>isApplied<span style=color:#f92672>(</span>filterInvocation<span style=color:#f92672>)</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>observeOncePerRequest</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
			<span style=color:#75715e>// filter already applied to this request and user wants us to observe
</span><span style=color:#75715e></span>			<span style=color:#75715e>// once-per-request handling, so don&#39;t re-do security checking
</span><span style=color:#75715e></span>			filterInvocation<span style=color:#f92672>.</span><span style=color:#a6e22e>getChain</span><span style=color:#f92672>().</span><span style=color:#a6e22e>doFilter</span><span style=color:#f92672>(</span>filterInvocation<span style=color:#f92672>.</span><span style=color:#a6e22e>getRequest</span><span style=color:#f92672>(),</span> filterInvocation<span style=color:#f92672>.</span><span style=color:#a6e22e>getResponse</span><span style=color:#f92672>());</span>
			<span style=color:#66d9ef>return</span><span style=color:#f92672>;</span>
		<span style=color:#f92672>}</span>
		<span style=color:#75715e>// first time this request being called, so perform security checking
</span><span style=color:#75715e></span>		<span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>filterInvocation<span style=color:#f92672>.</span><span style=color:#a6e22e>getRequest</span><span style=color:#f92672>()</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>null</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>observeOncePerRequest</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
			filterInvocation<span style=color:#f92672>.</span><span style=color:#a6e22e>getRequest</span><span style=color:#f92672>().</span><span style=color:#a6e22e>setAttribute</span><span style=color:#f92672>(</span>FILTER_APPLIED<span style=color:#f92672>,</span> Boolean<span style=color:#f92672>.</span><span style=color:#a6e22e>TRUE</span><span style=color:#f92672>);</span>
		<span style=color:#f92672>}</span>
		InterceptorStatusToken token <span style=color:#f92672>=</span> <span style=color:#66d9ef>super</span><span style=color:#f92672>.</span><span style=color:#a6e22e>beforeInvocation</span><span style=color:#f92672>(</span>filterInvocation<span style=color:#f92672>);</span> <span style=color:#75715e>// 前面的鏈必須通過才往下
</span><span style=color:#75715e></span>		<span style=color:#66d9ef>try</span> <span style=color:#f92672>{</span>
			filterInvocation<span style=color:#f92672>.</span><span style=color:#a6e22e>getChain</span><span style=color:#f92672>().</span><span style=color:#a6e22e>doFilter</span><span style=color:#f92672>(</span>filterInvocation<span style=color:#f92672>.</span><span style=color:#a6e22e>getRequest</span><span style=color:#f92672>(),</span> filterInvocation<span style=color:#f92672>.</span><span style=color:#a6e22e>getResponse</span><span style=color:#f92672>());</span>
		<span style=color:#f92672>}</span>
		<span style=color:#66d9ef>finally</span> <span style=color:#f92672>{</span>
			<span style=color:#66d9ef>super</span><span style=color:#f92672>.</span><span style=color:#a6e22e>finallyInvocation</span><span style=color:#f92672>(</span>token<span style=color:#f92672>);</span>
		<span style=color:#f92672>}</span>
		<span style=color:#66d9ef>super</span><span style=color:#f92672>.</span><span style=color:#a6e22e>afterInvocation</span><span style=color:#f92672>(</span>token<span style=color:#f92672>,</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>);</span>
	<span style=color:#f92672>}</span>
</code></pre></div><h3 id=exceptiontranslationfilter>ExceptionTranslationFilter</h3><p>顧名思義就是一個異常過濾器，用來處理認證授權過程中的異常。</p><h3 id=usernamepasswordauthenticationfilter>UsernamePasswordAuthenticationFilter</h3><p>針對 <code>/login</code> 進行攔截請求，並檢驗起內容。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java>    <span style=color:#a6e22e>@Override</span>
	<span style=color:#66d9ef>public</span> Authentication <span style=color:#a6e22e>attemptAuthentication</span><span style=color:#f92672>(</span>HttpServletRequest request<span style=color:#f92672>,</span> HttpServletResponse response<span style=color:#f92672>)</span>
			<span style=color:#66d9ef>throws</span> AuthenticationException <span style=color:#f92672>{</span>
		<span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span><span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>postOnly</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#f92672>!</span>request<span style=color:#f92672>.</span><span style=color:#a6e22e>getMethod</span><span style=color:#f92672>().</span><span style=color:#a6e22e>equals</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;POST&#34;</span><span style=color:#f92672>))</span> <span style=color:#f92672>{</span> <span style=color:#75715e>// 是否為 POST 請求
</span><span style=color:#75715e></span>			<span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> AuthenticationServiceException<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;Authentication method not supported: &#34;</span> <span style=color:#f92672>+</span> request<span style=color:#f92672>.</span><span style=color:#a6e22e>getMethod</span><span style=color:#f92672>());</span>
		<span style=color:#f92672>}</span>
		String username <span style=color:#f92672>=</span> obtainUsername<span style=color:#f92672>(</span>request<span style=color:#f92672>);</span> <span style=color:#75715e>// 獲取使用者名稱
</span><span style=color:#75715e></span>		username <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>username <span style=color:#f92672>!=</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>)</span> <span style=color:#f92672>?</span> username <span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;&#34;</span><span style=color:#f92672>;</span>
		username <span style=color:#f92672>=</span> username<span style=color:#f92672>.</span><span style=color:#a6e22e>trim</span><span style=color:#f92672>();</span>
		String password <span style=color:#f92672>=</span> obtainPassword<span style=color:#f92672>(</span>request<span style=color:#f92672>);</span> <span style=color:#75715e>// 獲取使用者密碼
</span><span style=color:#75715e></span>		password <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>password <span style=color:#f92672>!=</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>)</span> <span style=color:#f92672>?</span> password <span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;&#34;</span><span style=color:#f92672>;</span>
        <span style=color:#75715e>// 教驗
</span><span style=color:#75715e></span>		UsernamePasswordAuthenticationToken authRequest <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> UsernamePasswordAuthenticationToken<span style=color:#f92672>(</span>username<span style=color:#f92672>,</span> password<span style=color:#f92672>);</span>
		<span style=color:#75715e>// Allow subclasses to set the &#34;details&#34; property
</span><span style=color:#75715e></span>		setDetails<span style=color:#f92672>(</span>request<span style=color:#f92672>,</span> authRequest<span style=color:#f92672>);</span>
		<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>getAuthenticationManager</span><span style=color:#f92672>().</span><span style=color:#a6e22e>authenticate</span><span style=color:#f92672>(</span>authRequest<span style=color:#f92672>);</span>
	<span style=color:#f92672>}</span>
</code></pre></div><h2 id=過濾器加載過程>過濾器加載過程</h2><p>使用 Spring Security 時需配置過濾器，而 Spring boot 會幫我們自動配置。</p><h3 id=delegatingfilterproxy>DelegatingFilterProxy</h3><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#a6e22e>@Override</span>
	<span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>doFilter</span><span style=color:#f92672>(</span>ServletRequest request<span style=color:#f92672>,</span> ServletResponse response<span style=color:#f92672>,</span> FilterChain filterChain<span style=color:#f92672>)</span>
			<span style=color:#66d9ef>throws</span> ServletException<span style=color:#f92672>,</span> IOException <span style=color:#f92672>{</span>

		<span style=color:#75715e>// Lazily initialize the delegate if necessary.
</span><span style=color:#75715e></span>		Filter delegateToUse <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>delegate</span><span style=color:#f92672>;</span>
		<span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>delegateToUse <span style=color:#f92672>==</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
			<span style=color:#66d9ef>synchronized</span> <span style=color:#f92672>(</span><span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>delegateMonitor</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
				delegateToUse <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>delegate</span><span style=color:#f92672>;</span>
				<span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>delegateToUse <span style=color:#f92672>==</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
					WebApplicationContext wac <span style=color:#f92672>=</span> findWebApplicationContext<span style=color:#f92672>();</span>
					<span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>wac <span style=color:#f92672>==</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
						<span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> IllegalStateException<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;No WebApplicationContext found: &#34;</span> <span style=color:#f92672>+</span>
								<span style=color:#e6db74>&#34;no ContextLoaderListener or DispatcherServlet registered?&#34;</span><span style=color:#f92672>);</span>
					<span style=color:#f92672>}</span>
					delegateToUse <span style=color:#f92672>=</span> initDelegate<span style=color:#f92672>(</span>wac<span style=color:#f92672>);</span> <span style=color:#75715e>// 初始化
</span><span style=color:#75715e></span>				<span style=color:#f92672>}</span>
				<span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>delegate</span> <span style=color:#f92672>=</span> delegateToUse<span style=color:#f92672>;</span>
			<span style=color:#f92672>}</span>
		<span style=color:#f92672>}</span>

		<span style=color:#75715e>// Let the delegate perform the actual doFilter operation.
</span><span style=color:#75715e></span>		invokeDelegate<span style=color:#f92672>(</span>delegateToUse<span style=color:#f92672>,</span> request<span style=color:#f92672>,</span> response<span style=color:#f92672>,</span> filterChain<span style=color:#f92672>);</span>
	<span style=color:#f92672>}</span>
    <span style=color:#66d9ef>protected</span> Filter <span style=color:#a6e22e>initDelegate</span><span style=color:#f92672>(</span>WebApplicationContext wac<span style=color:#f92672>)</span> <span style=color:#66d9ef>throws</span> ServletException <span style=color:#f92672>{</span>
		String targetBeanName <span style=color:#f92672>=</span> getTargetBeanName<span style=color:#f92672>();</span>
		Assert<span style=color:#f92672>.</span><span style=color:#a6e22e>state</span><span style=color:#f92672>(</span>targetBeanName <span style=color:#f92672>!=</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>,</span> <span style=color:#e6db74>&#34;No target bean name set&#34;</span><span style=color:#f92672>);</span>
		Filter delegate <span style=color:#f92672>=</span> wac<span style=color:#f92672>.</span><span style=color:#a6e22e>getBean</span><span style=color:#f92672>(</span>targetBeanName<span style=color:#f92672>,</span> Filter<span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>);</span> <span style=color:#75715e>// 獲取 FilterChainProxy Bean
</span><span style=color:#75715e></span>		<span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>isTargetFilterLifecycle<span style=color:#f92672>())</span> <span style=color:#f92672>{</span>
			delegate<span style=color:#f92672>.</span><span style=color:#a6e22e>init</span><span style=color:#f92672>(</span>getFilterConfig<span style=color:#f92672>());</span>
		<span style=color:#f92672>}</span>
		<span style=color:#66d9ef>return</span> delegate<span style=color:#f92672>;</span>
	<span style=color:#f92672>}</span>
</code></pre></div><h2 id=重要的-interface>重要的 interface</h2><h3 id=userdetailsservice>UserDetailsService</h3><p>在正常情況下使用者帳號與密碼都是從資料庫中獲取，因此必須藉由此接口來自定義邏輯控制認證邏輯。
正常會繼層 <code>UsernamePasswordAuthenticationFilter</code> 並覆寫三個方法</p><ul><li>attemptAuthentication</li><li>successfulAuthentication</li><li>unsuccessfulAuthentication
實現 <code>UserDetailsService</code>，並與資料庫交互，返回 Spring Security 原生 <code>User</code> 物件</li></ul><h3 id=passwordencoder>PasswordEncoder</h3><p>用於數據加密，也就是使用者密碼。</p><h2 id=設置使用者帳號與密碼>設置使用者帳號與密碼</h2><ol><li>透過環境配置</li></ol><pre><code>spring.security.user.name=test
spring.security.user.password=test
</code></pre><ol start=2><li>使用配置類</li></ol><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#a6e22e>@Configuration</span>
<span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>SecurityConfig</span> <span style=color:#66d9ef>extends</span> WebSecurityConfigurerAdapter <span style=color:#f92672>{</span>
    <span style=color:#a6e22e>@Override</span>
    <span style=color:#66d9ef>protected</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>configure</span><span style=color:#f92672>(</span>AuthenticationManagerBuilder auth<span style=color:#f92672>)</span> <span style=color:#66d9ef>throws</span> Exception <span style=color:#f92672>{</span>
        <span style=color:#75715e>// TODO Auto-generated method stub
</span><span style=color:#75715e></span>        BCryptPasswordEncoder passwordEncoder <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> BCryptPasswordEncoder<span style=color:#f92672>();</span>
        String password <span style=color:#f92672>=</span> passwordEncoder<span style=color:#f92672>.</span><span style=color:#a6e22e>encode</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;test&#34;</span><span style=color:#f92672>);</span>
        auth<span style=color:#f92672>.</span><span style=color:#a6e22e>inMemoryAuthentication</span><span style=color:#f92672>().</span><span style=color:#a6e22e>withUser</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;test&#34;</span><span style=color:#f92672>).</span><span style=color:#a6e22e>password</span><span style=color:#f92672>(</span>password<span style=color:#f92672>).</span><span style=color:#a6e22e>roles</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;admin&#34;</span><span style=color:#f92672>);</span>
    <span style=color:#f92672>}</span>

    <span style=color:#a6e22e>@Bean</span>
    PasswordEncoder <span style=color:#a6e22e>passwordEncoder</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> BCryptPasswordEncoder<span style=color:#f92672>();</span>
    <span style=color:#f92672>}</span>

<span style=color:#f92672>}</span>
</code></pre></div><ol start=3><li>自定義實現類</li></ol><ul><li>建立使用 <code>UserDetailsService</code> 實現類</li></ul><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#a6e22e>@Configuration</span>
<span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>SecurityConfig</span> <span style=color:#66d9ef>extends</span> WebSecurityConfigurerAdapter <span style=color:#f92672>{</span>
    <span style=color:#a6e22e>@Autowired</span>
    UserDetailsService userDetailsService<span style=color:#f92672>;</span>
    <span style=color:#a6e22e>@Override</span>
    <span style=color:#66d9ef>protected</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>configure</span><span style=color:#f92672>(</span>AuthenticationManagerBuilder auth<span style=color:#f92672>)</span> <span style=color:#66d9ef>throws</span> Exception <span style=color:#f92672>{</span>
        <span style=color:#75715e>// TODO Auto-generated method stub
</span><span style=color:#75715e></span>        auth<span style=color:#f92672>.</span><span style=color:#a6e22e>userDetailsService</span><span style=color:#f92672>(</span>userDetailsService<span style=color:#f92672>).</span><span style=color:#a6e22e>passwordEncoder</span><span style=color:#f92672>(</span>passwordEncoder<span style=color:#f92672>());</span>
    <span style=color:#f92672>}</span>

    <span style=color:#a6e22e>@Bean</span>
    PasswordEncoder <span style=color:#a6e22e>passwordEncoder</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> BCryptPasswordEncoder<span style=color:#f92672>();</span>
    <span style=color:#f92672>}</span>
<span style=color:#f92672>}</span>
</code></pre></div><ul><li>覆寫方法，返回 <code>User</code> 物件，該物件有使用者名稱和密碼甚至是權限</li></ul><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#a6e22e>@Service</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;userDetailsService&#34;</span><span style=color:#f92672>)</span> <span style=color:#75715e>// 對應 SecurityConfig 類別的 UserDetailsService
</span><span style=color:#75715e></span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>CustomUserDetailsService</span> <span style=color:#66d9ef>implements</span> UserDetailsService <span style=color:#f92672>{</span>
    <span style=color:#75715e>// 根據使用者名稱做什麼事
</span><span style=color:#75715e></span>    <span style=color:#a6e22e>@Override</span>
    <span style=color:#66d9ef>public</span> UserDetails <span style=color:#a6e22e>loadUserByUsername</span><span style=color:#f92672>(</span>String username<span style=color:#f92672>)</span> <span style=color:#66d9ef>throws</span> UsernameNotFoundException <span style=color:#f92672>{</span>
        <span style=color:#75715e>// TODO Auto-generated method stub
</span><span style=color:#75715e></span>        List<span style=color:#f92672>&lt;</span>GrantedAuthority<span style=color:#f92672>&gt;</span> auths <span style=color:#f92672>=</span> AuthorityUtils<span style=color:#f92672>.</span><span style=color:#a6e22e>commaSeparatedStringToAuthorityList</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;role&#34;</span><span style=color:#f92672>);</span>
        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> User<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;mary&#34;</span><span style=color:#f92672>,</span> <span style=color:#66d9ef>new</span> BCryptPasswordEncoder<span style=color:#f92672>().</span><span style=color:#a6e22e>encode</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;123456&#34;</span><span style=color:#f92672>),</span> auths<span style=color:#f92672>);</span>
    <span style=color:#f92672>}</span>
    
<span style=color:#f92672>}</span>
</code></pre></div><h2 id=整合資料庫>整合資料庫</h2><ol><li>使用 Mybatis</li></ol><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#a6e22e>@Mapper</span>
<span style=color:#66d9ef>public</span> <span style=color:#66d9ef>interface</span> <span style=color:#a6e22e>UserMapper</span> <span style=color:#f92672>{</span>
    <span style=color:#a6e22e>@Select</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;SELECT * FROM public.user WHERE username = #{username}&#34;</span><span style=color:#f92672>)</span>
    User <span style=color:#a6e22e>getUserByUsername</span><span style=color:#f92672>(</span>String username<span style=color:#f92672>);</span>
<span style=color:#f92672>}</span>
</code></pre></div><ol start=2><li>使用 postgresql</li><li>使用 lombok</li></ol><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#a6e22e>@Data</span>
<span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>User</span> <span style=color:#f92672>{</span>
    <span style=color:#66d9ef>private</span> String id<span style=color:#f92672>;</span>
    <span style=color:#66d9ef>private</span> String username<span style=color:#f92672>;</span>
    <span style=color:#66d9ef>private</span> String password<span style=color:#f92672>;</span>
<span style=color:#f92672>}</span>
</code></pre></div><p>在 github 上可以查看詳細的代碼。但在開發時我們都會用自己的登入頁面，而不會使用 Spring security 提供的頁面。以下來進行自定義頁面的演示。</p><ol><li>實現相關配置</li></ol><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java>    <span style=color:#75715e>// SecurityConfig 進行配置
</span><span style=color:#75715e></span>    <span style=color:#a6e22e>@Override</span>
    <span style=color:#66d9ef>protected</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>configure</span><span style=color:#f92672>(</span>HttpSecurity http<span style=color:#f92672>)</span> <span style=color:#66d9ef>throws</span> Exception <span style=color:#f92672>{</span>
        <span style=color:#75715e>// TODO Auto-generated method stub
</span><span style=color:#75715e></span>        http<span style=color:#f92672>.</span><span style=color:#a6e22e>formLogin</span><span style=color:#f92672>()</span> <span style=color:#75715e>// 自定義編寫登入頁面
</span><span style=color:#75715e></span>            <span style=color:#f92672>.</span><span style=color:#a6e22e>loginPage</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;/login.html&#34;</span><span style=color:#f92672>)</span>
            <span style=color:#f92672>.</span><span style=color:#a6e22e>loginProcessingUrl</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;/user/login&#34;</span><span style=color:#f92672>)</span> <span style=color:#75715e>// 登入後訪問路徑
</span><span style=color:#75715e></span>            <span style=color:#f92672>.</span><span style=color:#a6e22e>defaultSuccessUrl</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;/api/v1/index&#34;</span><span style=color:#f92672>)</span> <span style=color:#75715e>// 登入後跳轉路徑
</span><span style=color:#75715e></span>            <span style=color:#f92672>.</span><span style=color:#a6e22e>permitAll</span><span style=color:#f92672>()</span>
            <span style=color:#f92672>.</span><span style=color:#a6e22e>and</span><span style=color:#f92672>().</span><span style=color:#a6e22e>authorizeRequests</span><span style=color:#f92672>()</span>
            <span style=color:#f92672>.</span><span style=color:#a6e22e>antMatchers</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;/&#34;</span><span style=color:#f92672>,</span> <span style=color:#e6db74>&#34;/api/v1/hello&#34;</span><span style=color:#f92672>,</span> <span style=color:#e6db74>&#34;/user/login&#34;</span><span style=color:#f92672>).</span><span style=color:#a6e22e>permitAll</span><span style=color:#f92672>()</span> <span style=color:#75715e>// 不需要認證即可訪問
</span><span style=color:#75715e></span>            <span style=color:#f92672>.</span><span style=color:#a6e22e>anyRequest</span><span style=color:#f92672>().</span><span style=color:#a6e22e>authenticated</span><span style=color:#f92672>()</span>
            <span style=color:#f92672>.</span><span style=color:#a6e22e>and</span><span style=color:#f92672>().</span><span style=color:#a6e22e>csrf</span><span style=color:#f92672>().</span><span style=color:#a6e22e>disable</span><span style=color:#f92672>();</span> <span style=color:#75715e>// 關閉 csrf 保護
</span><span style=color:#75715e></span>    <span style=color:#f92672>}</span>
</code></pre></div><p>建立一個簡單的 html 登入頁面</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html>    &lt;<span style=color:#f92672>form</span> <span style=color:#a6e22e>action</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;/user/login&#34;</span> <span style=color:#a6e22e>method</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;post&#34;</span>&gt;
        User: &lt;<span style=color:#f92672>input</span> <span style=color:#a6e22e>type</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;text&#34;</span> <span style=color:#a6e22e>name</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;username&#34;</span>&gt; <span style=color:#75715e>&lt;!-- 須為 username Spring Security 才能獲取--&gt;</span>
        &lt;<span style=color:#f92672>br</span>&gt;
        Password: &lt;<span style=color:#f92672>input</span> <span style=color:#a6e22e>type</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;password&#34;</span> <span style=color:#a6e22e>name</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;password&#34;</span>&gt; <span style=color:#75715e>&lt;!-- 須為 password Spring Security 才能獲取--&gt;</span>
        &lt;<span style=color:#f92672>br</span>&gt;
        &lt;<span style=color:#f92672>input</span> <span style=color:#a6e22e>type</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;submit&#34;</span> <span style=color:#a6e22e>value</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;login&#34;</span>&gt;
    &lt;/<span style=color:#f92672>form</span>&gt;
</code></pre></div><p>這邊設定好後，<code>/api/v1/hello</code> 可直接訪問，<code>/api/v1/index</code> 會被跳轉至 login 頁面，登入後即可存取。</p><h2 id=基於角色或權限的訪問控制>基於角色或權限的訪問控制</h2><p>其作法有以下四種</p><ul><li>hasAuthority<ul><li>當前的請求者具有指定的權限，例如該使用者有 Admin 權限</li></ul></li><li>hasAnyAuthority</li><li>hasRole</li><li>hasAnyRole</li></ul><h3 id=hasauthority>hasAuthority</h3><p>以下的 <code>.antMatchers("/api/v1/index").hasAuthority("admins")</code> 當前使用者，只有具有 admins 權限才能存取</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java>	<span style=color:#a6e22e>@Override</span>
    <span style=color:#66d9ef>protected</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>configure</span><span style=color:#f92672>(</span>HttpSecurity http<span style=color:#f92672>)</span> <span style=color:#66d9ef>throws</span> Exception <span style=color:#f92672>{</span>
        <span style=color:#75715e>// TODO Auto-generated method stub
</span><span style=color:#75715e></span>        http<span style=color:#f92672>.</span><span style=color:#a6e22e>formLogin</span><span style=color:#f92672>()</span> <span style=color:#75715e>// 自定義編寫登入頁面
</span><span style=color:#75715e></span>            <span style=color:#f92672>.</span><span style=color:#a6e22e>loginPage</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;/login.html&#34;</span><span style=color:#f92672>)</span>
            <span style=color:#f92672>.</span><span style=color:#a6e22e>loginProcessingUrl</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;/user/login&#34;</span><span style=color:#f92672>)</span> <span style=color:#75715e>// 登入後訪問路徑
</span><span style=color:#75715e></span>            <span style=color:#f92672>.</span><span style=color:#a6e22e>defaultSuccessUrl</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;/api/v1/index&#34;</span><span style=color:#f92672>)</span> <span style=color:#75715e>// 登入後跳轉路徑
</span><span style=color:#75715e></span>            <span style=color:#f92672>.</span><span style=color:#a6e22e>permitAll</span><span style=color:#f92672>()</span>
            <span style=color:#f92672>.</span><span style=color:#a6e22e>and</span><span style=color:#f92672>().</span><span style=color:#a6e22e>authorizeRequests</span><span style=color:#f92672>()</span>
            <span style=color:#f92672>.</span><span style=color:#a6e22e>antMatchers</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;/&#34;</span><span style=color:#f92672>,</span> <span style=color:#e6db74>&#34;/api/v1/hello&#34;</span><span style=color:#f92672>,</span> <span style=color:#e6db74>&#34;/user/login&#34;</span><span style=color:#f92672>).</span><span style=color:#a6e22e>permitAll</span><span style=color:#f92672>()</span> <span style=color:#75715e>// 不需要認證即可訪問
</span><span style=color:#75715e></span>            <span style=color:#f92672>.</span><span style=color:#a6e22e>antMatchers</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;/api/v1/index&#34;</span><span style=color:#f92672>).</span><span style=color:#a6e22e>hasAuthority</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;admins&#34;</span><span style=color:#f92672>)</span>
            <span style=color:#f92672>.</span><span style=color:#a6e22e>anyRequest</span><span style=color:#f92672>().</span><span style=color:#a6e22e>authenticated</span><span style=color:#f92672>()</span>
            <span style=color:#f92672>.</span><span style=color:#a6e22e>and</span><span style=color:#f92672>().</span><span style=color:#a6e22e>csrf</span><span style=color:#f92672>().</span><span style=color:#a6e22e>disable</span><span style=color:#f92672>();</span> <span style=color:#75715e>// 關閉 csrf 保護
</span><span style=color:#75715e></span>    <span style=color:#f92672>}</span>
</code></pre></div><p>我們透過 <code>UserDetailsService</code> 的 <code>User</code> 物件中給予權限</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java>List<span style=color:#f92672>&lt;</span>GrantedAuthority<span style=color:#f92672>&gt;</span> auths <span style=color:#f92672>=</span> AuthorityUtils<span style=color:#f92672>.</span><span style=color:#a6e22e>commaSeparatedStringToAuthorityList</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;admins&#34;</span><span style=color:#f92672>);</span>
</code></pre></div><p>假設不匹配時，將返回 403 HTTP 代碼。但此種方法不適合一個使用者有多個權限角色。</p><h3 id=hasanyauthority>hasAnyAuthority</h3><p>當前請求者有任何提供的角色，也就是一個使用者被綁定多個角色時。使用方式如下</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#75715e>// antMatchers(&#34;/api/v1/index&#34;).hasAuthority(&#34;admins,manager&#34;) 無法應用於多角色
</span><span style=color:#75715e></span>antMatchers<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;/api/v1/index&#34;</span><span style=color:#f92672>).</span><span style=color:#a6e22e>hasAnyAuthority</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;admins,manager&#34;</span><span style=color:#f92672>)</span>
</code></pre></div><h3 id=hasrole>hasRole</h3><p>如果請求者具備給定角色就允許訪問，否則回應 403 HTTP 代碼。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java>antMatchers<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;/api/v1/index&#34;</span><span style=color:#f92672>).</span><span style=color:#a6e22e>hasRole</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;sale&#34;</span><span style=color:#f92672>)</span> 
</code></pre></div><p>在底層下說明需要以 <code>ROLE_</code> 進行開頭</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java>	<span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> String <span style=color:#a6e22e>hasRole</span><span style=color:#f92672>(</span>String role<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
		Assert<span style=color:#f92672>.</span><span style=color:#a6e22e>notNull</span><span style=color:#f92672>(</span>role<span style=color:#f92672>,</span> <span style=color:#e6db74>&#34;role cannot be null&#34;</span><span style=color:#f92672>);</span>
		Assert<span style=color:#f92672>.</span><span style=color:#a6e22e>isTrue</span><span style=color:#f92672>(!</span>role<span style=color:#f92672>.</span><span style=color:#a6e22e>startsWith</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;ROLE_&#34;</span><span style=color:#f92672>),</span>
				<span style=color:#f92672>()</span> <span style=color:#f92672>-&gt;</span> <span style=color:#e6db74>&#34;role should not start with &#39;ROLE_&#39; since it is automatically inserted. Got &#39;&#34;</span> <span style=color:#f92672>+</span> role <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;&#39;&#34;</span><span style=color:#f92672>);</span>
		<span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#34;hasRole(&#39;ROLE_&#34;</span> <span style=color:#f92672>+</span> role <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;&#39;)&#34;</span><span style=color:#f92672>;</span>
	<span style=color:#f92672>}</span>
</code></pre></div><p>以 <code>sale</code> 來說我們需設置</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java>List<span style=color:#f92672>&lt;</span>GrantedAuthority<span style=color:#f92672>&gt;</span> auths <span style=color:#f92672>=</span> AuthorityUtils<span style=color:#f92672>.</span><span style=color:#a6e22e>commaSeparatedStringToAuthorityList</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;ROLE_sale&#34;</span><span style=color:#f92672>);</span>
</code></pre></div><h3 id=hasanyrole>hasAnyRole</h3><p>表示能設定多個角色，只要符合一個即可存取。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java>antMatchers<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;/api/v1/index&#34;</span><span style=color:#f92672>).</span><span style=color:#a6e22e>hasAnyRole</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;sale, pm&#34;</span><span style=color:#f92672>)</span> 
</code></pre></div><p>以上的方式只要沒有權限就回傳 403，我們可以自定義此頁面，並在 <code>configure</code> 方法進行配置即可</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java>	<span style=color:#a6e22e>@Override</span>
    <span style=color:#66d9ef>protected</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>configure</span><span style=color:#f92672>(</span>HttpSecurity http<span style=color:#f92672>)</span> <span style=color:#66d9ef>throws</span> Exception <span style=color:#f92672>{</span>
        <span style=color:#75715e>// TODO Auto-generated method stub
</span><span style=color:#75715e></span>        http<span style=color:#f92672>.</span><span style=color:#a6e22e>exceptionHandling</span><span style=color:#f92672>().</span><span style=color:#a6e22e>accessDeniedPage</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;/403.html&#34;</span><span style=color:#f92672>);</span> <span style=color:#75715e>// 沒權限時自動跳轉此頁面
</span><span style=color:#75715e></span>        http<span style=color:#f92672>.</span><span style=color:#a6e22e>formLogin</span><span style=color:#f92672>()</span> <span style=color:#75715e>// 自定義編寫登入頁面
</span><span style=color:#75715e></span>            <span style=color:#f92672>...</span>
            <span style=color:#f92672>.</span><span style=color:#a6e22e>anyRequest</span><span style=color:#f92672>().</span><span style=color:#a6e22e>authenticated</span><span style=color:#f92672>()</span>
            <span style=color:#f92672>.</span><span style=color:#a6e22e>and</span><span style=color:#f92672>().</span><span style=color:#a6e22e>csrf</span><span style=color:#f92672>().</span><span style=color:#a6e22e>disable</span><span style=color:#f92672>();</span> <span style=color:#75715e>// 關閉 csrf 保護
</span><span style=color:#75715e></span>    <span style=color:#f92672>}</span>
</code></pre></div><p>以上我們可以了解到基本的 Spring Security 配置以及權限方面控管。</p></div><div class="d-flex flex-row justify-content-around"><h3 class="mb-1 mt-1 text-left mr-4"><a href=/code/2021-10-27-error-handler-spring-boot/ title="Spring boot Web 開發 - Error Handler"><i class="nav-menu fas fa-chevron-circle-left"></i></a></h3><h3 class="mb-1 mt-1 text-left ml-4"><a href=/code/2021-10-29-spring-security-annotation/ title="Spring security - annotation"><i class="nav-menu fas fa-chevron-circle-right"></i></a></h3></div></main><footer class="mt-2 mb-4 text-center"><span class=markdownify>short copyright message</span>
<span>&#183;
<i><a href=https://github.com/darshanbaral/aafu>aafu</a></i>
by
<a href=https://www.darshanbaral.com/>darshan</a></span></footer></body></html>