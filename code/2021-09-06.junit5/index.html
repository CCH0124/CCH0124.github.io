<!doctype html><html lang=en-us style=max-width:1000px;margin:auto><head><title>Kevin Blog</title><meta name=theme-color content><meta charset=utf-8><meta content="width=device-width,initial-scale=1" name=viewport><meta name=description content="Kevin learning"><meta name=author content="Kevin Chen"><meta name=generator content="aafu theme by Darshan in Hugo 0.83.0"><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/safari-pinned-tab.svg color=#252627><link rel="shortcut icon" href=/favicon.ico><link rel=stylesheet href=/css/bootstrap/bootstrap.min.css><link rel=stylesheet href=https://use.fontawesome.com/releases/v5.15.2/css/all.css integrity=sha384-vSIIfh2YWi9wW0r9iZe7RJPrKwp6bG+s9QZMoITbCckVJqGCCRhc+ccxNcdpHuYu crossorigin=anonymous><link rel=stylesheet href=https://cdn.rawgit.com/jpswalsh/academicons/master/css/academicons.min.css><link rel=stylesheet href="//fonts.googleapis.com/css?family=Didact+Gothic%7CRoboto:400%7CRoboto+Mono"><link rel=stylesheet href=/css/aafu_pinkish.css><link rel=stylesheet href=/css/aafu.css><script>var themeColor=document.querySelector("meta[name=theme-color]");window.onload=()=>{themeColor.content=getComputedStyle(document.body)["background-color"];let a=document.querySelector(".accordion.active");a&&(a.nextElementSibling.style.maxHeight=a.nextElementSibling.scrollHeight+"px")},window.onresize=()=>{let a=document.querySelector(".accordion.active");a&&(a.nextElementSibling.style.maxHeight=a.nextElementSibling.scrollHeight+"px")}</script></head><body class=container><main style="min-height:calc(100vh - 60px)"><div class="d-flex flex-row row p-2"><h3 class="main-menu mr-3"><a href=https://cch0124.github.io/>Home</a></h3><h3 class="main-menu mr-3"><a href=/blog>Blog</a></h3><h3 class="main-menu mr-3"><a href=/project>Project</a></h3><h3 class="main-menu mr-3"><a href=/life>Life</a></h3><h3 class="main-menu mr-3"><a href=/kubernetes>Kubernetes</a></h3><h3 class="main-menu mr-3"><a href=/code>Coding</a></h3></div><div class=mb-3><h1 class=top-h1 style=font-size:2.75em>單元測試</h1><p class=mb-1>September 6, 2021</p><p>&mdash;</p></div><div class=content><p>Junit5 是目前最新的框架，其由三個模組組成</p><ul><li>JUnit Platform<ul><li>在 JVM 上啟動測試框架的基礎，在 Junit 之外的框架都能接入</li></ul></li><li>JUnit Jupiter<ul><li>Junit5 的核心，內部包含了一個測試引擎，用於在 JUnit Platform 上運行</li></ul></li><li>JUnit Vintage<ul><li>&mldr;</li></ul></li></ul><pre><code>___________________________________________________________________________________________________________________________________
|                                                                                                                                  | 
|                                                                                                                                  |
|                                            Junit5                                                                                |
|               ________________________        ________________________        ________________________                           |
|               |                       |       |                       |       |                       |                          |
|               |                       |       |                       |       |                       |                          |     
|               |   JUnit Platform      |   +   |   JUnit Jupiter       |   +   |  JUnit Vintage        |                          | 
|               |                       |       |                       |       |                       |                          | 
|               |_______________________|       |_______________________|       |_______________________|                          | 
|                                                                                                                                  |
|                                                                                                                                  |
|                                                                                                                                  |
|                                                                                                                                  |
|__________________________________________________________________________________________________________________________________|

</code></pre><blockquote><p>Srping boot 2.4 以上版本移除預設對 Vitage 的依賴，所以不能使用 Junit4 的功能</p></blockquote><h2 id=junit5-常用註解>Junit5 常用註解</h2><table><thead><tr><th>注解</th><th>描述</th></tr></thead><tbody><tr><td>@Test</td><td>表示當前方法是測試方法</td></tr><tr><td>@ParameterizedTest</td><td>表示方法是參數化測試</td></tr><tr><td>@RepeatedTest</td><td>表示方法可重複執行</td></tr><tr><td>@DisplayName</td><td>在測試類別或測試方法設置顯示名稱</td></tr><tr><td>@BeforeEach</td><td>在每個單元測試前執行</td></tr><tr><td>@AfterEach</td><td>在每個單元測試後執行</td></tr><tr><td>@BeforeAll</td><td>在所有單元測試前執行</td></tr><tr><td>@AfterAll</td><td>在所有單元測試後執行</td></tr><tr><td>@Tag</td><td>表示單元測試類別</td></tr><tr><td>@Disable</td><td>表示測試類或方法不執行</td></tr><tr><td>@Timeout</td><td>當測試方法運行超過指定時間將回傳錯誤</td></tr><tr><td>@ExtendWith</td><td>測試類或方法提供擴展類引用</td></tr></tbody></table><h2 id=assertions-斷言>Assertions 斷言</h2><p>斷言方法都是來至 <code>org.junit.jupiter.api.Assertions</code> 的靜態方法。可用來驗證業務邏輯是否正確。</p><h3 id=基本>基本</h3><table><thead><tr><th>方法</th><th>描述</th></tr></thead><tbody><tr><td>assertEquals</td><td>判別兩個物件是否相等</td></tr><tr><td>assertNotEquals</td><td>判別兩個物件是否不相等</td></tr><tr><td>assertSame</td><td>判別兩個物件引用是否指向同一個物件</td></tr><tr><td>assertNotSame</td><td>判別兩個物件引用是否指向非同一個物件</td></tr><tr><td>assertTrue</td><td>判別傳入 boolean 值是否為 true</td></tr><tr><td>assertFalse</td><td>判別傳入 boolean 值是否為 false</td></tr><tr><td>assertNull</td><td>判別物件是否為 null</td></tr><tr><td>assertNotNull</td><td>判別物件是否為非 null</td></tr></tbody></table><h3 id=數組斷言>數組斷言</h3><p>透過 <code>assertArrayEquals</code> 方法來判斷兩個對像或原始類型的數組是否相等</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#a6e22e>@Test</span>
<span style=color:#a6e22e>@DisplayName</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;array assertion&#34;</span><span style=color:#f92672>)</span>
<span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>arrayTest</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
    assertArrayEquals<span style=color:#f92672>(</span><span style=color:#66d9ef>new</span> <span style=color:#66d9ef>int</span><span style=color:#f92672>[]{</span>1<span style=color:#f92672>,</span> 2<span style=color:#f92672>},</span> <span style=color:#66d9ef>new</span> <span style=color:#66d9ef>int</span><span style=color:#f92672>[]</span> <span style=color:#f92672>{</span>1<span style=color:#f92672>,</span> 2<span style=color:#f92672>});</span>
<span style=color:#f92672>}</span>
</code></pre></div><h3 id=組合斷言>組合斷言</h3><p>透過 <code>assertAll</code> 可傳入多個 <code>org.junit.jupiter.api.Executable</code> function interface 的方式做為要驗證的斷言。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#a6e22e>@Test</span>
<span style=color:#a6e22e>@DisplayName</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;assert all&#34;</span><span style=color:#f92672>)</span>
<span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>allTest</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
    assertAll<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;Math&#34;</span><span style=color:#f92672>,</span>
        <span style=color:#f92672>()</span> <span style=color:#f92672>-&gt;</span> assertEquals<span style=color:#f92672>(</span>2<span style=color:#f92672>,</span> 1 <span style=color:#f92672>+</span> 1<span style=color:#f92672>),</span>
        <span style=color:#f92672>()</span> <span style=color:#f92672>-&gt;</span> assertTrue<span style=color:#f92672>(</span>1 <span style=color:#f92672>&gt;</span> 0<span style=color:#f92672>)</span>
    <span style=color:#f92672>);</span>
<span style=color:#f92672>}</span>
</code></pre></div><h3 id=異常斷言>異常斷言</h3><p>使用 <code>assertThrows</code> 搭配 lambda 語法</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#a6e22e>@Test</span>
<span style=color:#a6e22e>@DisplayName</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;Assert Exception&#34;</span><span style=color:#f92672>)</span>
<span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>exceptionTest</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
    ArithmeticException exception <span style=color:#f92672>=</span> Assertions<span style=color:#f92672>.</span><span style=color:#a6e22e>assertThrows</span><span style=color:#f92672>(</span> ArithmeticException<span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>,</span> <span style=color:#f92672>()</span> <span style=color:#f92672>-&gt;</span> System<span style=color:#f92672>.</span><span style=color:#a6e22e>out</span><span style=color:#f92672>.</span><span style=color:#a6e22e>println</span><span style=color:#f92672>(</span>1 <span style=color:#f92672>%</span> 0<span style=color:#f92672>));</span>
<span style=color:#f92672>}</span>
</code></pre></div><h2 id=參數化測試>參數化測試</h2><p>為了讓測試的參數有多種可能。可以使用不同的參數進行多個單元測試，而不需要每新增一個參數就添加一個單元測試，省去很多不必要的重複代碼等。</p><table><thead><tr><th>方法</th><th>描述</th></tr></thead><tbody><tr><td>@ValueSource</td><td>指定參數來源，基本上支援 JAVA 中基礎類和 class、String 類別</td></tr><tr><td>@NullSource</td><td>提供 null 型態參數</td></tr><tr><td>@EnumSource</td><td>提供 Enum 型態參數</td></tr><tr><td>@CsvFileSource</td><td>讀取提供的 CSV 檔案內容作為參數值</td></tr><tr><td>@MethodSource</td><td>獲取指定方法的回傳值作為參數，<em>但這需要是一個 stream 類型</em></td></tr></tbody></table><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#a6e22e>@ParameterizedTest</span>
<span style=color:#a6e22e>@ValueSource</span><span style=color:#f92672>(</span>strings <span style=color:#f92672>=</span> <span style=color:#f92672>{</span><span style=color:#e6db74>&#34;one&#34;</span><span style=color:#f92672>,</span> <span style=color:#e6db74>&#34;two&#34;</span><span style=color:#f92672>,</span> <span style=color:#e6db74>&#34;three&#34;</span><span style=color:#f92672>})</span>
<span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>parameterizedTest1</span><span style=color:#f92672>(</span>String string<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
    Assertions<span style=color:#f92672>.</span><span style=color:#a6e22e>assertTrue</span><span style=color:#f92672>(</span>StringUtils<span style=color:#f92672>.</span><span style=color:#a6e22e>isNotBlank</span><span style=color:#f92672>(</span>string<span style=color:#f92672>));</span>
<span style=color:#f92672>}</span>


<span style=color:#a6e22e>@ParameterizedTest</span>
<span style=color:#a6e22e>@MethodSource</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;method&#34;</span><span style=color:#f92672>)</span>
<span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>testWithExplicitLocalMethodSource</span><span style=color:#f92672>(</span>String name<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
    Assertions<span style=color:#f92672>.</span><span style=color:#a6e22e>assertNotNull</span><span style=color:#f92672>(</span>name<span style=color:#f92672>);</span>
<span style=color:#f92672>}</span>

<span style=color:#66d9ef>static</span> Stream<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>method</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
    <span style=color:#66d9ef>return</span> Stream<span style=color:#f92672>.</span><span style=color:#a6e22e>of</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;apple&#34;</span><span style=color:#f92672>,</span> <span style=color:#e6db74>&#34;banana&#34;</span><span style=color:#f92672>);</span>
<span style=color:#f92672>}</span>
</code></pre></div></div><div class="d-flex flex-row justify-content-around"><h3 class="mb-1 mt-1 text-left mr-4"><a href=/code/2021-01-12-missing-number/ title="LeetCode 268 Missing Number"><i class="nav-menu fas fa-chevron-circle-left"></i></a></h3><h3 class="mb-1 mt-1 text-left ml-4"><a href=/code/2021-10-17-spring-boot/ title="Spring boot 概觀"><i class="nav-menu fas fa-chevron-circle-right"></i></a></h3></div></main><footer class="mt-2 mb-4 text-center"><span class=markdownify>short copyright message</span>
<span>&#183;
<i><a href=https://github.com/darshanbaral/aafu>aafu</a></i>
by
<a href=https://www.darshanbaral.com/>darshan</a></span></footer></body></html>