<!doctype html><html lang=en-us style=max-width:1000px;margin:auto><head><title>Kevin Blog</title><meta name=theme-color content><meta charset=utf-8><meta content="width=device-width,initial-scale=1" name=viewport><meta name=description content="Kevin learning"><meta name=author content="Kevin Chen"><meta name=generator content="aafu theme by Darshan in Hugo 0.83.0"><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/safari-pinned-tab.svg color=#252627><link rel="shortcut icon" href=/favicon.ico><link rel=stylesheet href=/css/bootstrap/bootstrap.min.css><link rel=stylesheet href=https://use.fontawesome.com/releases/v5.15.2/css/all.css integrity=sha384-vSIIfh2YWi9wW0r9iZe7RJPrKwp6bG+s9QZMoITbCckVJqGCCRhc+ccxNcdpHuYu crossorigin=anonymous><link rel=stylesheet href=https://cdn.rawgit.com/jpswalsh/academicons/master/css/academicons.min.css><link rel=stylesheet href="//fonts.googleapis.com/css?family=Didact+Gothic%7CRoboto:400%7CRoboto+Mono"><link rel=stylesheet href=/css/aafu_pinkish.css><link rel=stylesheet href=/css/aafu.css><script>var themeColor=document.querySelector("meta[name=theme-color]");window.onload=()=>{themeColor.content=getComputedStyle(document.body)["background-color"];let a=document.querySelector(".accordion.active");a&&(a.nextElementSibling.style.maxHeight=a.nextElementSibling.scrollHeight+"px")},window.onresize=()=>{let a=document.querySelector(".accordion.active");a&&(a.nextElementSibling.style.maxHeight=a.nextElementSibling.scrollHeight+"px")}</script></head><body class=container><main style="min-height:calc(100vh - 60px)"><div class="d-flex flex-row row p-2"><h3 class="main-menu mr-3"><a href=https://cch0124.github.io/>Home</a></h3><h3 class="main-menu mr-3"><a href=/blog>Blog</a></h3><h3 class="main-menu mr-3"><a href=/project>Project</a></h3><h3 class="main-menu mr-3"><a href=/life>Life</a></h3><h3 class="main-menu mr-3"><a href=/kubernetes>Kubernetes</a></h3><h3 class="main-menu mr-3"><a href=/code>Coding</a></h3></div><div class=mb-3><h1 class=top-h1 style=font-size:2.75em>csv combine</h1><p class=mb-1>February 13, 2020</p><p>&mdash;</p></div><div class=content><p>資料集有分為幾十種的種類，每一種類的資料大小都起碼 1G，由於深度學習時資料只有一個種類會不大理想，因此要將這些多個類型的檔案合併成一個。
我使用了 <code>pandas</code>，程式碼如下</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#f92672>import</span> pandas <span style=color:#f92672>as</span> pd
<span style=color:#f92672>import</span> os
<span style=color:#f92672>import</span> glob
csv_file_path <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;DATA_ROOT_PATH&#39;</span>
os<span style=color:#f92672>.</span>chdir(csv_file_path)
list_of_file <span style=color:#f92672>=</span> [file <span style=color:#66d9ef>for</span> file <span style=color:#f92672>in</span> blob<span style=color:#f92672>.</span>glob(<span style=color:#e6db74>&#39;DrDos_*.csv&#39;</span>)] 
combined_csv <span style=color:#f92672>=</span> pd<span style=color:#f92672>.</span>concat([pd<span style=color:#f92672>.</span>read_csv(f) <span style=color:#66d9ef>for</span> f <span style=color:#f92672>in</span> list_of_file[:<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>]])
combined_csv<span style=color:#f92672>.</span>to_csv(<span style=color:#e6db74>&#39;SAVE_PATH&#39;</span>, index<span style=color:#f92672>=</span>True)
</code></pre></div><p>個人配置是 32GB，但在處裡 2 個 4G 檔案做合併時就會發生記憶體不足的問體。問題點可能是</p><ol><li>檔案真的太大</li><li>該檔案裡的資料型態佔據的記憶體空間。因為有時資料只有 0 或 1，卻用 <code>int64</code> 來儲存，那豈不是佔據空間</li></ol><p>之後嘗試用，shell <code>awk</code>和管道來處理，該機器有 22G 記憶體空間，但在執行時，看不出記憶體變化程度，這優化不知道是怎麼回事&mldr;。
之所以用 <code>awk</code> 是因為檔案中的 <code>header</code> 是一樣的，在合併時需要將該 <code>header</code> 省略，在配合著 <code>>></code> 附加作用，即可完成。當然這種導向的輸出 <code>cat</code>、<code>paste</code> 等都可以做到，但因為沒省略 <code>header</code> 的方式，所以就沒用了。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>awk <span style=color:#e6db74>&#39;FNR &gt; 1&#39;</span> file.csv file2.csv &gt;&gt; output.csv
</code></pre></div></div><div class="d-flex flex-row justify-content-around"><h3 class="mb-1 mt-1 text-left mr-4"><a href=/blog/2020-01-05-router-on-a-stick/ title=router-on-a-stick><i class="nav-menu fas fa-chevron-circle-left"></i></a></h3><h3 class="mb-1 mt-1 text-left ml-4"><a href=/blog/2020-05-17-ann-wireshark/ title="wireshark analysis Ann’s Bad AIM"><i class="nav-menu fas fa-chevron-circle-right"></i></a></h3></div></main><footer class="mt-2 mb-4 text-center"><span class=markdownify>short copyright message</span>
<span>&#183;
<i><a href=https://github.com/darshanbaral/aafu>aafu</a></i>
by
<a href=https://www.darshanbaral.com/>darshan</a></span></footer></body></html>