<!doctype html><html lang=en-us style=max-width:1000px;margin:auto><head><title>Kevin Blog</title><meta name=theme-color content><meta charset=utf-8><meta content="width=device-width,initial-scale=1" name=viewport><meta name=description content="Kevin learning"><meta name=author content="Kevin Chen"><meta name=generator content="aafu theme by Darshan in Hugo 0.83.0"><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/safari-pinned-tab.svg color=#252627><link rel="shortcut icon" href=/favicon.ico><link rel=stylesheet href=/css/bootstrap/bootstrap.min.css><link rel=stylesheet href=https://use.fontawesome.com/releases/v5.15.2/css/all.css integrity=sha384-vSIIfh2YWi9wW0r9iZe7RJPrKwp6bG+s9QZMoITbCckVJqGCCRhc+ccxNcdpHuYu crossorigin=anonymous><link rel=stylesheet href=https://cdn.rawgit.com/jpswalsh/academicons/master/css/academicons.min.css><link rel=stylesheet href="//fonts.googleapis.com/css?family=Didact+Gothic%7CRoboto:400%7CRoboto+Mono"><link rel=stylesheet href=/css/aafu_pinkish.css><link rel=stylesheet href=/css/aafu.css><script>var themeColor=document.querySelector("meta[name=theme-color]");window.onload=()=>{themeColor.content=getComputedStyle(document.body)["background-color"];let a=document.querySelector(".accordion.active");a&&(a.nextElementSibling.style.maxHeight=a.nextElementSibling.scrollHeight+"px")},window.onresize=()=>{let a=document.querySelector(".accordion.active");a&&(a.nextElementSibling.style.maxHeight=a.nextElementSibling.scrollHeight+"px")}</script></head><body class=container><main style="min-height:calc(100vh - 60px)"><div class="d-flex flex-row row p-2"><h3 class="main-menu mr-3"><a href=https://cch0124.github.io/>Home</a></h3><h3 class="main-menu mr-3"><a href=/blog>Blog</a></h3><h3 class="main-menu mr-3"><a href=/project>Project</a></h3><h3 class="main-menu mr-3"><a href=/life>Life</a></h3><h3 class="main-menu mr-3"><a href=/kubernetes>Kubernetes</a></h3><h3 class="main-menu mr-3"><a href=/code>Coding</a></h3></div><div class=mb-3><h1 class=top-h1 style=font-size:2.75em>Docker 基礎介紹</h1><p class=mb-1>October 5, 2019</p><p>&mdash;</p></div><div class=content><h2 id=why-do-you-need-docker>Why do you need Docker</h2><p>從先前的架構來看，建置一個網站需要有 <code>Apache</code>、<code>MySQL</code>、<code>PHP</code> 等。其中它們都依賴於當前的作業系統或著有些服務因為版本而依賴於不同的函式庫。因此這讓架構會變得有點凌亂導致新進的工程師必須去了解此凌亂的架構才能進行工作，而 <code>Docker</code> 技術能夠幾乎解決這樣的問題。</p><h2 id=what-can-i-do>What can I do</h2><p>從下圖看出，在作業系統上裝一個 <code>Docker</code>，並透過 <code>docker run</code> 去建置容器。<code>Docker</code> 能夠將每個運行服務的每一個組件，丟至該服務容器（container）中，讓每個服務依賴於該容器中被定義的 <code>image</code>。</p><p><img src=https://i.imgur.com/MA3Ek1u.png alt>
by docker.com</p><p>那這又跟 VM 又有麼差異呢 ? 在資源使用率上會有<a href=https://www.inwinstack.com/2017/10/13/vm-container-difference/>差異</a>。</p><h2 id=what-is-container>What is container</h2><p>一種隔離環境的技術， 可以擁有自己的 <code>process</code>、<code>network</code>、<code>mount</code>，但是容器會共用 <code>kernel</code>。在又 <code>Docker</code> 此技術之前，容器的概念先前就有，像是 <code>lkx</code>、<code>chroot</code> 等。但整合方面的完整性都歸功於 <code>Docker</code>。
<code>container</code> 應該要說是一種概念，<code>Docker</code> 是一個實作 <code>container</code> 的技術。<code>container</code> 竟然是一種概念，它必定有規範，稱作 <code>Open Container Initiative (OCI)</code>。藉由此標準可以提升 <code>container</code> 不同解決方案的相容性。
然而，<code>Open Container Initiative (OCI)</code> 定義兩大的標準</p><ul><li><a href=https://github.com/opencontainers/runtime-spec/blob/master/spec.md>Runtime Specification</a></li><li><a href=https://github.com/opencontainers/image-spec/blob/master/spec.md>Image Specification</a></li></ul><p>對於 <code>Docker</code> 來說，<code>image</code> 相關的操作 <code>images/pull/push</code> 等甚至是藉由 <code>Dockerfile</code> 來建立自己的工作環境，這些都牽扯到了 <code>image</code>。<code>Image Specification</code> 就是來規範 <code>Image</code>。
相對的 <code>Runtime Specification</code> 是控制 <code>container</code> 的生命週期 <code>create/delete/start/stop</code> 或是運行 <code>container</code> 時透過 <code>exec/attach</code> 與 <code>container</code> 的互動。對於 <code>container</code> 中，隔離會使用 <code>namespace</code> 來完成，<code>namespace</code> 操作會有 <code>pid</code>、<code>network</code>、<code>ipc</code>、<code>mount</code> 等。</p><h2 id=run-container>Run container</h2><p><code>Dockerfile</code> 是建構 <code>image</code> 的檔案，而 <code>container</code> 就是運行 <code>image</code> 的結果。</p><p><img src=https://geekflare.com/wp-content/uploads/2019/07/dockerfile.png alt>
by geekflare.com</p><h3 id=example>Example</h3><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>/test$ tree
.
└── Dockerfile
</code></pre></div><h5 id=define-nginx-dockerfile>Define nginx Dockerfile</h5><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>FROM ubuntu:14.04

RUN apt-get update <span style=color:#f92672>&amp;&amp;</span> apt-get install -y nginx

COPY . /var/www/html/

EXPOSE <span style=color:#ae81ff>80</span>

<span style=color:#75715e>#ENTRYPOINT [&#34;nginx&#34;]</span>
CMD <span style=color:#f92672>[</span><span style=color:#e6db74>&#34;nginx&#34;</span>, <span style=color:#e6db74>&#34;-g&#34;</span>, <span style=color:#e6db74>&#34;daemon off;&#34;</span><span style=color:#f92672>]</span>
</code></pre></div><h5 id=build>Build</h5><p>使用 <code>docker build -t {ImageName}:{tag01} .</code> 建構</p><p>使用 <code>docker images</code> 查看建構的 image</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>REPOSITORY                                          TAG                 IMAGE ID            CREATED             SIZE
nginx                                               v0                  55077273116a        <span style=color:#ae81ff>20</span> minutes ago      222MB
</code></pre></div><h5 id=fix-dockerfile>Fix Dockerfile</h5><p><code>image</code> 原則上應該越小越好</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>FROM ubuntu:14.04

RUN apt-get update <span style=color:#f92672>&amp;&amp;</span> apt-get install -y nginx <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>        <span style=color:#f92672>&amp;&amp;</span> rm -rf /var/lib/apt/lists/*

COPY . /var/www/html/

EXPOSE <span style=color:#ae81ff>80</span>

<span style=color:#75715e>#ENTRYPOINT [&#34;nginx&#34;]</span>
CMD <span style=color:#f92672>[</span><span style=color:#e6db74>&#34;nginx&#34;</span>, <span style=color:#e6db74>&#34;-g&#34;</span>, <span style=color:#e6db74>&#34;daemon off;&#34;</span><span style=color:#f92672>]</span>

</code></pre></div><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>REPOSITORY                                          TAG                 IMAGE ID            CREATED             SIZE
nginx                                               v0.1                d17658937ea9        <span style=color:#ae81ff>2</span> minutes ago       209MB
</code></pre></div><p>上面就成功運行了一個 <code>container</code>。</p><h2 id=ref>ref</h2><ul><li><a href=https://www.docker.com/resources/what-container>官網 what-container</a></li><li><a href=https://www.hwchiu.com/container-design-i.html>淺談 Container 設計原理(I)</a></li><li><a href=https://geekflare.com/dockerfile-tutorial/>dockerfile-tutorial</a></li></ul></div><div class="d-flex flex-row justify-content-around"><h3 class="mb-1 mt-1 text-left mr-4"><a href=/blog/2019-09-23-flutter-bottom/ title=底部滑動按鈕><i class="nav-menu fas fa-chevron-circle-left"></i></a></h3><h3 class="mb-1 mt-1 text-left ml-4"><a href=/blog/2019-11-06-cisco-telnet/ title="cisco telnet"><i class="nav-menu fas fa-chevron-circle-right"></i></a></h3></div></main><footer class="mt-2 mb-4 text-center"><span class=markdownify>short copyright message</span>
<span>&#183;
<i><a href=https://github.com/darshanbaral/aafu>aafu</a></i>
by
<a href=https://www.darshanbaral.com/>darshan</a></span></footer></body></html>