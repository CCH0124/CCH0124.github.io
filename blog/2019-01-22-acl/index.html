<!doctype html><html lang=en-us style=max-width:1000px;margin:auto><head><title>Kevin Blog</title><meta name=theme-color content><meta charset=utf-8><meta content="width=device-width,initial-scale=1" name=viewport><meta name=description content="Kevin learning"><meta name=author content="Kevin Chen"><meta name=generator content="aafu theme by Darshan in Hugo 0.83.0"><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/safari-pinned-tab.svg color=#252627><link rel="shortcut icon" href=/favicon.ico><link rel=stylesheet href=/css/bootstrap/bootstrap.min.css><link rel=stylesheet href=https://use.fontawesome.com/releases/v5.15.2/css/all.css integrity=sha384-vSIIfh2YWi9wW0r9iZe7RJPrKwp6bG+s9QZMoITbCckVJqGCCRhc+ccxNcdpHuYu crossorigin=anonymous><link rel=stylesheet href=https://cdn.rawgit.com/jpswalsh/academicons/master/css/academicons.min.css><link rel=stylesheet href="//fonts.googleapis.com/css?family=Didact+Gothic%7CRoboto:400%7CRoboto+Mono"><link rel=stylesheet href=/css/aafu_pinkish.css><link rel=stylesheet href=/css/aafu.css><script>var themeColor=document.querySelector("meta[name=theme-color]");window.onload=()=>{themeColor.content=getComputedStyle(document.body)["background-color"];let a=document.querySelector(".accordion.active");a&&(a.nextElementSibling.style.maxHeight=a.nextElementSibling.scrollHeight+"px")},window.onresize=()=>{let a=document.querySelector(".accordion.active");a&&(a.nextElementSibling.style.maxHeight=a.nextElementSibling.scrollHeight+"px")}</script></head><body class=container><main style="min-height:calc(100vh - 60px)"><div class="d-flex flex-row row p-2"><h3 class="main-menu mr-3"><a href=https://cch0124.github.io/>Home</a></h3><h3 class="main-menu mr-3"><a href=/blog>Blog</a></h3><h3 class="main-menu mr-3"><a href=/project>Project</a></h3><h3 class="main-menu mr-3"><a href=/life>Life</a></h3><h3 class="main-menu mr-3"><a href=/kubernetes>Kubernetes</a></h3><h3 class="main-menu mr-3"><a href=/code>Coding</a></h3></div><div class=mb-3><h1 class=top-h1 style=font-size:2.75em>ACL</h1><p class=mb-1>January 22, 2019</p><p>&mdash;</p></div><div class=content><h1 id=acl>ACL</h1><p>IP Access Control Lists (ACLs)，根據以下內容過濾 IP 數據包：</p><ul><li>Source address</li><li>Destination address</li><li>Type of packet</li><li>Any combination of these items</li></ul><p>為了要過濾網路流量，ACL 控制是否在路由器 interface 上 <code>forward</code> 或 <code>drop</code> 路由數據包。</p><ul><li>Source address of the traffic</li><li>Destination address of the traffic</li><li>Upper-layer protocol</li></ul><p><strong>Standard ACLs</strong> 將 IP 數據包的 source address 與 ACL中配置的 address 進行比較，以控制流量，但不能針對特定的網路協定指定允許或拒絕的動作處理。
<strong>Extended ACLs</strong> 將 IP 數據包的 source address 和 destination address 與 ACL 中配置的地址進行比較或針對特定的網路協定做處置，以控制流量。可以使 extended ACL 更精細，並配置為按以下標準過濾流量：</p><ul><li>Protocol</li><li>Port numbers</li><li>Differentiated services code point (DSCP) value</li><li>Precedence value</li><li>State of the synchronize sequence number (SYN) bit</li></ul><h2 id=埠號及所對應的網路服務>埠號及所對應的網路服務</h2><table><thead><tr><th>Port</th><th>TCP/UDP</th><th>IP protocol</th></tr></thead><tbody><tr><td>20</td><td>TCP</td><td>FTP 的資料</td></tr><tr><td>21</td><td>TCP</td><td>FTP 控制</td></tr><tr><td>22</td><td>TCP</td><td>SSH</td></tr><tr><td>23</td><td>TCP</td><td>Telnet</td></tr><tr><td>25</td><td>TCP</td><td>SMTP</td></tr><tr><td>53</td><td>TCP/UDP</td><td>DNS</td></tr><tr><td>69</td><td>UDP</td><td>TFTP</td></tr><tr><td>80</td><td>TCP</td><td>HTTP</td></tr></tbody></table><h2 id=inbound-與-outbound>Inbound 與 Outbound</h2><h4 id=inbound>Inbound</h4><p>流向路由器的封包
<img src=https://i.imgur.com/uVUNymg.png alt></p><h4 id=outbound>Outbound</h4><p>路由器設備流出去的封包
<img src=https://i.imgur.com/PreoHKL.png alt></p><p>上兩點符合<strong>First Match</strong>都是第一條規則匹配則套用規則。</p><blockquote><p>Inbound 的方式會有較好的性能，因先藉由存取控制清單先過濾，再進行路由表的查詢。</p></blockquote><h2 id=拓樸>拓樸</h2><p><img src=https://i.imgur.com/D8YHhhx.png alt></p><p>Created by David Bombal.
Get more at <a href=http://davidbombal.com>http://davidbombal.com</a></p><p>Configure ACLs as follows:</p><h3 id=restrict-traffic-internally-using-router1-as-follows>Restrict traffic internally using Router1 as follows:</h3><ul><li>Use access list number 100</li><li>Inside PC1 can only access the HTTP server 1 using HTTP on subnet 10.1.1.0/24</li></ul><p><img src=https://i.imgur.com/ouew1LG.png alt></p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>Router1<span style=color:#f92672>(</span>config<span style=color:#f92672>)</span><span style=color:#75715e>#access-list 100 permit tcp host 10.1.2.101 host 10.1.1.100 eq 80</span>
</code></pre></div><ul><li>Inside PC2 can only access the HTTP server 2 using HTTPS on subnet 10.1.1.0/24</li></ul><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>Router1<span style=color:#f92672>(</span>config<span style=color:#f92672>)</span><span style=color:#75715e>#access-list 100 permit tcp host 10.1.2.102 host 10.1.1.101 eq 443</span>
</code></pre></div><ul><li>No other PCs or servers on subnet 10.1.2.0/24 can access subnet 10.1.1.0/24 (Explicitly add this line. This is normally done to log the traffic with the word log, but PT does not support logging)</li></ul><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>Router1<span style=color:#f92672>(</span>config<span style=color:#f92672>)</span><span style=color:#75715e>#access-list 100 deny ip 10.1.2.0 0.0.0.255 10.1.1.0 0.0.0.255</span>
</code></pre></div><ul><li>Hosts on subnet 10.1.2.0/24 can access any other network</li></ul><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>Router1<span style=color:#f92672>(</span>config<span style=color:#f92672>)</span><span style=color:#75715e>#access-list 100 permit ip 10.1.2.0 0.0.0.255 any </span>
</code></pre></div><ul><li>Bind access list in the most efficient place on Router1
Cisco 路由器的設定模式包括 <code>User Mode</code> 和 <code>Privileged Mode</code>，以及 <code>Global Configuration Mode</code>。</li></ul><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>Router1<span style=color:#f92672>(</span>config<span style=color:#f92672>)</span><span style=color:#75715e>#interface gigabitEthernet 0/0/0</span>
Router1<span style=color:#f92672>(</span>config-if<span style=color:#f92672>)</span><span style=color:#75715e>#ip access-group 100 in </span>
</code></pre></div><p>在 <code>Global Configuration Mode</code> 之下還有以下五種設定模式：</p><ol><li>Interface Mode</li><li>Sub-interface Mode</li><li>Controller Mode</li><li>Line Mode</li><li>Router Mode</li></ol><h3 id=verification>Verification:</h3><ul><li>Verify that Inside PC1 can access the internal HTTP server 1 using HTTP, but not ping HTTP server 2</li></ul><p><img src=https://i.imgur.com/Bzq16dw.png alt></p><ul><li>Verify that Inside PC2 can access the internal HTTP server 2 using HTTPS, but not ping HTTP server 1
<img src=https://i.imgur.com/st7bRDJ.png alt></li></ul><p><img src=https://i.imgur.com/v3Z1tmM.png alt></p><ul><li>Verify that both inside PC1 and PC2 can browse to cisco.com and facebook.com
<img src=https://i.imgur.com/4ECQGyK.png alt>
<img src=https://i.imgur.com/rsqMoWr.png alt></li></ul><h2 id=顯示-acl-規則>顯示 ACL 規則</h2><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>Router1<span style=color:#f92672>(</span>config<span style=color:#f92672>)</span><span style=color:#75715e>#do sh access</span>
Extended IP access list <span style=color:#ae81ff>100</span>
    <span style=color:#ae81ff>10</span> permit tcp host 10.1.2.101 host 10.1.1.100 eq www
    <span style=color:#ae81ff>20</span> permit tcp host 10.1.2.102 host 10.1.1.101 eq <span style=color:#ae81ff>443</span>
    <span style=color:#ae81ff>30</span> deny ip 10.1.2.0 0.0.0.255 10.1.1.0 0.0.0.255
    <span style=color:#ae81ff>40</span> permit ip 10.1.2.0 0.0.0.255 any
</code></pre></div><h2 id=刪除特定-acl-規則>刪除特定 ACL 規則</h2><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>Router1<span style=color:#f92672>(</span>config<span style=color:#f92672>)</span><span style=color:#75715e>#ip access-list extended 100</span>
Router1<span style=color:#f92672>(</span>config-ext-nacl<span style=color:#f92672>)</span><span style=color:#75715e>#no 40</span>
Router1<span style=color:#f92672>(</span>config-ext-nacl<span style=color:#f92672>)</span><span style=color:#75715e>#do sh access</span>
Extended IP access list <span style=color:#ae81ff>100</span>
    <span style=color:#ae81ff>10</span> permit tcp host 10.1.2.101 host 10.1.1.100 eq www
    <span style=color:#ae81ff>20</span> permit tcp host 10.1.2.102 host 10.1.1.101 eq <span style=color:#ae81ff>443</span>
    <span style=color:#ae81ff>30</span> deny ip 10.1.2.0 0.0.0.255 10.1.1.0 0.0.0.255
Router1<span style=color:#f92672>(</span>config<span style=color:#f92672>)</span><span style=color:#75715e>#access-list 100 permit ip 10.1.2.0 0.0.0.255 any</span>
</code></pre></div><h2 id=插入特定-acl-規則>插入特定 ACL 規則</h2><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>Router1<span style=color:#f92672>(</span>config<span style=color:#f92672>)</span><span style=color:#75715e>#ip access-list extended 100</span>
Router1<span style=color:#f92672>(</span>config-ext-nacl<span style=color:#f92672>)</span><span style=color:#75715e>#no 20</span>
Router1<span style=color:#f92672>(</span>config-ext-nacl<span style=color:#f92672>)</span><span style=color:#75715e>#do sh access</span>
Extended IP access list <span style=color:#ae81ff>100</span>
    <span style=color:#ae81ff>10</span> permit tcp host 10.1.2.101 host 10.1.1.100 eq www
    <span style=color:#ae81ff>30</span> deny ip 10.1.2.0 0.0.0.255 10.1.1.0 0.0.0.255
    <span style=color:#ae81ff>40</span> permit ip 10.1.2.0 0.0.0.255 any
<span style=color:#75715e># 插入動作</span>
Router1<span style=color:#f92672>(</span>config-ext-nacl<span style=color:#f92672>)</span><span style=color:#75715e>#20 permit tcp host 10.1.2.102 host 10.1.1.101 eq 443</span>
Router1<span style=color:#f92672>(</span>config-ext-nacl<span style=color:#f92672>)</span><span style=color:#75715e>#do sh access </span>
Extended IP access list <span style=color:#ae81ff>100</span>
    <span style=color:#ae81ff>10</span> permit tcp host 10.1.2.101 host 10.1.1.100 eq www
    <span style=color:#ae81ff>20</span> permit tcp host 10.1.2.102 host 10.1.1.101 eq <span style=color:#ae81ff>443</span>
    <span style=color:#ae81ff>30</span> deny ip 10.1.2.0 0.0.0.255 10.1.1.0 0.0.0.255
    <span style=color:#ae81ff>40</span> permit ip 10.1.2.0 0.0.0.255 any
</code></pre></div><h2 id=查看-acl-match>查看 ACL match</h2><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>Router1#sh access-lists <span style=color:#ae81ff>100</span>
Extended IP access list <span style=color:#ae81ff>100</span>
    permit tcp host 10.1.2.101 host 10.1.1.100 eq www <span style=color:#f92672>(</span><span style=color:#ae81ff>6</span> match<span style=color:#f92672>(</span>es<span style=color:#f92672>))</span>
    permit tcp host 10.1.2.102 host 10.1.1.101 eq <span style=color:#ae81ff>443</span> <span style=color:#f92672>(</span><span style=color:#ae81ff>11</span> match<span style=color:#f92672>(</span>es<span style=color:#f92672>))</span>
    deny ip 10.1.2.0 0.0.0.255 10.1.1.0 0.0.0.255 <span style=color:#f92672>(</span><span style=color:#ae81ff>114</span> match<span style=color:#f92672>(</span>es<span style=color:#f92672>))</span>
    permit ip 10.1.2.0 0.0.0.255 any <span style=color:#f92672>(</span><span style=color:#ae81ff>213</span> match<span style=color:#f92672>(</span>es<span style=color:#f92672>))</span>
</code></pre></div><h2 id=ref>Ref</h2><p><a href="https://www.youtube.com/watch?v=kAnGDqws9Z4&list=PLhfrWIlLOoKMCJLkWbgPJ9aI9_Kx4No7O&index=22">youtube</a></p><p><a href=https://www.cisco.com/c/en/us/support/docs/ip/access-lists/26448-ACLsamples.html#anc0>cisco ACL</a></p></div><div class="d-flex flex-row justify-content-around"><h3 class="mb-1 mt-1 text-left mr-4"><a href=/blog/2019-01-05-rip/ title="RIP 與子網路切割"><i class="nav-menu fas fa-chevron-circle-left"></i></a></h3><h3 class="mb-1 mt-1 text-left ml-4"><a href=/blog/2019-02-14-duplicati/ title=Backup><i class="nav-menu fas fa-chevron-circle-right"></i></a></h3></div></main><footer class="mt-2 mb-4 text-center"><span class=markdownify>short copyright message</span>
<span>&#183;
<i><a href=https://github.com/darshanbaral/aafu>aafu</a></i>
by
<a href=https://www.darshanbaral.com/>darshan</a></span></footer></body></html>