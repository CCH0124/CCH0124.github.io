<!doctype html><html lang=en-us style=max-width:1000px;margin:auto><head><title>Kevin Blog</title><meta name=theme-color content><meta charset=utf-8><meta content="width=device-width,initial-scale=1" name=viewport><meta name=description content="Kevin learning"><meta name=author content="Kevin Chen"><meta name=generator content="aafu theme by Darshan in Hugo 0.83.0"><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/safari-pinned-tab.svg color=#252627><link rel="shortcut icon" href=/favicon.ico><link rel=stylesheet href=/css/bootstrap/bootstrap.min.css><link rel=stylesheet href=https://use.fontawesome.com/releases/v5.15.2/css/all.css integrity=sha384-vSIIfh2YWi9wW0r9iZe7RJPrKwp6bG+s9QZMoITbCckVJqGCCRhc+ccxNcdpHuYu crossorigin=anonymous><link rel=stylesheet href=https://cdn.rawgit.com/jpswalsh/academicons/master/css/academicons.min.css><link rel=stylesheet href="//fonts.googleapis.com/css?family=Didact+Gothic%7CRoboto:400%7CRoboto+Mono"><link rel=stylesheet href=/css/aafu_pinkish.css><link rel=stylesheet href=/css/aafu.css><script>var themeColor=document.querySelector("meta[name=theme-color]");window.onload=()=>{themeColor.content=getComputedStyle(document.body)["background-color"];let a=document.querySelector(".accordion.active");a&&(a.nextElementSibling.style.maxHeight=a.nextElementSibling.scrollHeight+"px")},window.onresize=()=>{let a=document.querySelector(".accordion.active");a&&(a.nextElementSibling.style.maxHeight=a.nextElementSibling.scrollHeight+"px")}</script></head><body class=container><main style="min-height:calc(100vh - 60px)"><div class="d-flex flex-row row p-2"><h3 class="main-menu mr-3"><a href=https://cch0124.github.io/>Home</a></h3><h3 class="main-menu mr-3"><a href=/blog>Blog</a></h3><h3 class="main-menu mr-3"><a href=/project>Project</a></h3><h3 class="main-menu mr-3"><a href=/life>Life</a></h3><h3 class="main-menu mr-3"><a href=/kubernetes>Kubernetes</a></h3><h3 class="main-menu mr-3"><a href=/code>Coding</a></h3></div><div class=mb-3><h1 class=top-h1 style=font-size:2.75em>wireshark analysis Ann’s Bad AIM</h1><p class=mb-1>May 17, 2020</p><p>&mdash;</p></div><div class=content><p><a href=http://forensicscontest.com/2009/09/25/puzzle-1-anns-bad-aim>題目網站</a></p><p>Ann’s computer, (192.168.1.158) sent IMs over the wireless network to this computer. 這一句話可發現 Ann 的 IP 為 <code>192.168.1.158</code>，和使用的應用程式。</p><p>該應用程式為<a href=https://zh.wikipedia.org/wiki/%E5%8D%B3%E6%99%82%E9%80%9A%E8%A8%8A>IM 協定</a>，<code>tcp port</code> 為 <code>5190</code></p><h2 id=題目>題目</h2><ol><li>What is the name of Ann’s IM buddy?</li><li>What was the first comment in the captured IM conversation?</li><li>What is the name of the file Ann transferred?</li><li>What is the magic number of the file you want to extract (first four bytes)?</li><li>What was the MD5sum of the file?</li><li>What is the secret recipe?</li></ol><h3 id=1-what-is-the-name-of-anns-im-buddy>1. What is the name of Ann’s IM buddy?</h3><pre><code class="language-shell=" data-lang="shell=">ip.dst == 192.168.1.158
</code></pre><p>透過上面指令將 <code>192.168.1.158</code> 先過濾，發現協定有 <code>SSL</code>、<code>TCP</code> 等，其中 <code>SSL</code> 和 <code>TCP</code> 較重要，因此可透過 <code>stream</code> 方式查看。但由於使用的是非標準端口，該流量 <code>TCP</code> 的 <code>port</code> 為 <code>443</code> 有誤認的情形，須使用<code>Decode As</code>，將當前協定修正為 <code>AIM</code>，<code>Protocol</code> 欄位會將 <code>AIM</code> 解析出來，</p><p><img src=https://i.imgur.com/lqhvi3X.png alt></p><p>其中 ANN Buddy Name 是 <code>sec558user1</code></p><h3 id=what-was-the-first-comment-in-the-captured-im-conversation>What was the first comment in the captured IM conversation?</h3><p>先前透過 IP 過濾出封包，因此過濾出來的第一個 <code>AIM</code> 協定，即可得知。</p><p><img src=https://i.imgur.com/wcbYKt7.png alt></p><p><code>ValueMessage: Here's the secret recipe... I just downloaded it from the file server. Just copy to a thumb drive and you're good to go &amp;gt;:-)</code></p><h3 id=3-what-is-the-name-of-the-file-ann-transferred>3. What is the name of the file Ann transferred?</h3><p>先猜想是否用 <code>AIM</code> 方式傳遞檔案，畢竟 <code>AIM</code> 可傳遞檔案。</p><pre><code class="language-shell=" data-lang="shell=">ip.addr == 192.168.1.158 &amp;&amp; tcp.port == 5190

</code></pre><p>上述方式過濾出 <code>5190 port</code> 封包。用 <code>TCP stream</code> 查看，發現 <code>recipe.docx</code> 檔案。</p><h3 id=4-what-is-the-magic-number-of-the-file-you-want-to-extract-first-four-bytes>4. What is the magic number of the file you want to extract (first four bytes)?</h3><p>透過上面找到的封包，使用 TCP stream 觀看。並 GOOGLE 找一下 DOCX 的魔術數字&mldr;</p><p><img src=https://i.imgur.com/DVYqw8b.png alt></p><p>使用 Hex 查看 <img src=https://i.imgur.com/Oy9nIiE.png alt></p><p><code>pk</code> 為關鍵字，也就是 <code>50 4B 03 04</code>，</p><ul><li><a href=https://www.garykessler.net/library/file_sigs.html>魔術數字</a></li></ul><h3 id=5-what-was-the-md5sum-of-the-file>5. What was the MD5sum of the file?</h3><p>docx 的標頭分別為 <code>50 4B 03 04</code> 或 <code>50 4B 03 04 14 00 06 00</code>。
接著開啟 <code>TCP Stream</code> 並將編碼轉成 <code>Raw</code>，並將其下載並命名<code>recipe.docx</code>，並計算該檔案的 <code>hash</code></p><pre><code class="language-shell=" data-lang="shell=">$ md5sum recipe.docx
52c13d8c0a99ac0d3210e8e8edb046bf *recipe.docx
</code></pre><p><code>52c13d8c0a99ac0d3210e8e8edb046bf</code> 為該檔案的 <code>hash</code> 值</p><h3 id=6-what-is-the-secret-recipe>6. What is the secret recipe?</h3><p>透過上提下載的檔案，打開後裡面內容為</p><p><img src=https://i.imgur.com/KEIhIeT.png alt></p><h5 id=補充>補充</h5><p><code>stream</code> 功能從多個封包裡，把分散的資料在重整一致、容易判讀的格式，稱之封包文本（packet transcript），這樣不必在用戶端與伺服器之間往來的封包片段中檢閱。</p><ul><li>TCP stream<ul><li>從使用 TCP 的協定中把資料組合起來</li></ul></li><li>SSL stream<ul><li>從已加密的協定中把資料組合起來</li><li>需有密鑰才能解</li></ul></li><li>查看時，紅色是送出內容，藍色是接收內容</li></ul><h2 id=參考>參考</h2><ul><li><a href=https://wiki.wireshark.org/AIM>AIM</a></li><li><a href=https://crypto.stackexchange.com/questions/53786/why-is-ssl-on-top-of-tcp>TCP 和 SSL</a></li></ul></div><div class="d-flex flex-row justify-content-around"><h3 class="mb-1 mt-1 text-left mr-4"><a href=/blog/2020-02-13-csv-combine/ title="csv combine"><i class="nav-menu fas fa-chevron-circle-left"></i></a></h3><h3 class="mb-1 mt-1 text-left ml-4"><a href=/blog/2020-05-18-ann-skips-bail-wireshark/ title="wireshark analysis Ann Skips Bail"><i class="nav-menu fas fa-chevron-circle-right"></i></a></h3></div></main><footer class="mt-2 mb-4 text-center"><span class=markdownify>short copyright message</span>
<span>&#183;
<i><a href=https://github.com/darshanbaral/aafu>aafu</a></i>
by
<a href=https://www.darshanbaral.com/>darshan</a></span></footer></body></html>