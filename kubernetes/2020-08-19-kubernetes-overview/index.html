<!doctype html><html lang=en-us style=max-width:1000px;margin:auto><head><title>Kevin Blog</title><meta name=theme-color content><meta charset=utf-8><meta content="width=device-width,initial-scale=1" name=viewport><meta name=description content="Kevin learning"><meta name=author content="Kevin Chen"><meta name=generator content="aafu theme by Darshan in Hugo 0.83.0"><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/safari-pinned-tab.svg color=#252627><link rel="shortcut icon" href=/favicon.ico><link rel=stylesheet href=/css/bootstrap/bootstrap.min.css><link rel=stylesheet href=https://use.fontawesome.com/releases/v5.15.2/css/all.css integrity=sha384-vSIIfh2YWi9wW0r9iZe7RJPrKwp6bG+s9QZMoITbCckVJqGCCRhc+ccxNcdpHuYu crossorigin=anonymous><link rel=stylesheet href=https://cdn.rawgit.com/jpswalsh/academicons/master/css/academicons.min.css><link rel=stylesheet href="//fonts.googleapis.com/css?family=Didact+Gothic%7CRoboto:400%7CRoboto+Mono"><link rel=stylesheet href=/css/aafu_pinkish.css><link rel=stylesheet href=/css/aafu.css><script>var themeColor=document.querySelector("meta[name=theme-color]");window.onload=()=>{themeColor.content=getComputedStyle(document.body)["background-color"];let a=document.querySelector(".accordion.active");a&&(a.nextElementSibling.style.maxHeight=a.nextElementSibling.scrollHeight+"px")},window.onresize=()=>{let a=document.querySelector(".accordion.active");a&&(a.nextElementSibling.style.maxHeight=a.nextElementSibling.scrollHeight+"px")}</script></head><body class=container><main style="min-height:calc(100vh - 60px)"><div class="d-flex flex-row row p-2"><h3 class="main-menu mr-3"><a href=https://cch0124.github.io/>Home</a></h3><h3 class="main-menu mr-3"><a href=/blog>Blog</a></h3><h3 class="main-menu mr-3"><a href=/project>Project</a></h3><h3 class="main-menu mr-3"><a href=/life>Life</a></h3><h3 class="main-menu mr-3"><a href=/kubernetes>Kubernetes</a></h3><h3 class="main-menu mr-3"><a href=/code>Coding</a></h3></div><div class=mb-3><h1 class=top-h1 style=font-size:2.75em>K8s-day01</h1><p class=mb-1>August 19, 2020</p><p>&mdash;</p></div><div class=content><h2 id=什麼是-kubernetes>什麼是 Kubernetes</h2><p>Kubernetes 是一個集群管理系統，它擁有可移植、擴展和高可用等特性。它用於管理容器(container)，然而容器的出現改變了佈署方式。容器類似於 VM 與主機共享內核(kernel)，容器有自己的檔案系統(filesystem)、CPU、記憶體(memory)、進程空間(process space)等。因為它們與基礎架構分離，因此可以跨雲(公、私有或混合雲中)和作業系統進行移植。然而容器佈署的數量越多管理難度明顯的會提升，使用者必須對容器進行分組，並對其分配網路、監控或安全等服務。藉由 kubernetes 提供的編排和管理功能，以便完成大規模佈署，且 kubernetes 提供了資源調度、容器擴展等管理功能，這些的作用讓 kubernetes 可以管理容器應用程式的生命週期。</p><h2 id=kubernetes-架構>Kubernetes 架構</h2><p>Kubernetes 匯集多個物理機、虛擬機將其變成一個集群。如下圖</p><figure><img src=/images/k8s/K8s-day01.jpg width=auto height=auto></figure><ul><li>master<ul><li>是用戶端與集群之間的核心聯絡重要位置</li><li>追蹤其它服務器的健康狀態</li><li>以最佳方式調度工作的負載</li><li>編排其它組件之間的任務</li></ul></li><li>node<ul><li>集群中的工作節點，負責接收來自 master 的工作調度<ul><li>創建或銷毀 <code>POD</code></li><li>調整網路好讓路由與轉發流量</li></ul></li></ul></li><li>POD<ul><li><code>Kubernetes</code> 中嘴小運算單元</li><li>封裝多個容器</li><li>一個 <code>POD</code> 中的容器共享 <code>namespace</code> 和儲存資源，但彼此又在 <code>mount</code>、<code>user</code>、<code>PID</code> 等名稱空間保持隔離</li></ul></li></ul><p>在 kubernetes 中有很多的組件會來支撐整個集群的運作邏輯，像是編排、暴露、恢復等，之後文章會慢慢的提到。</p><h2 id=master-組件>master 組件</h2><h3 id=api-server>API Server</h3><p>負責輸出 <code>RESTful</code> 的 Kubernetes API，負責接收和驗證相關的請求，其狀態資源會被存入 <code>etcd</code> 中。</p><h3 id=etcd>etcd</h3><p>該 <code>etcd</code> 會確保生產環境的可用性。它會提供監聽的機制，用於推送和監聽變更。只要有發生變化便會與 <code>API Server</code> 溝通，並做出適當的動作向客戶端輸出。</p><h3 id=controller-manager>Controller Manager</h3><p>控制器完成的功能包括<em>生命週期</em>和 <code>API</code> 一些邏輯。</p><ul><li>生命週期<ul><li><code>namespace</code> 創建</li><li><code>Event</code> 垃圾回收</li><li><code>POD</code> 終止相關垃圾回收</li><li>等等</li></ul></li><li>API<ul><li><code>ReplicaSet</code></li><li><code>DaemonSet</code></li><li>等等</li></ul></li></ul><h3 id=scheduler>Scheduler</h3><p>當 <code>API Server</code> 確認 <code>POD</code> 對象的建立請求後，需要由 <code>Scheduler</code> 根據集群內各節點的可用資源狀態，以及要運行的容器資源需求做出調度決策。總而言之就是幫助 API Server 尋找合適節點部署。</p><p>使用以下流程進行容器佈署</p><ul><li>Filtering<ul><li>淘汰不適合的節點</li><li>可能從以下資源進行過濾<ul><li>CPU</li><li>Memory</li><li>GPU</li></ul></li></ul></li><li>Scoring<ul><li>進行加權，將過濾的節點進行，分數比較。可能是不要跟某節點一起等</li></ul></li><li>Deploying<ul><li>從 scoring 選擇最高分數，並回傳 <code>API Server</code> 由它處裡</li></ul></li></ul><h2 id=node-組件>Node 組件</h2><h3 id=kubelete>kubelete</h3><p>運行於工作節點之上的一個進程，從 <code>API Server</code> 接收關於 <code>POD</code> 對象的<em>配置訊息</em>並確保處於期望的狀態。同時也會向 <code>master</code> 報告節點資源狀態。<code>kubelet</code> 依賴於 <code>CRI</code> 來創建容器。</p><h3 id=kube-proxy>kube-proxy</h3><p>工作節點的進程，按需為 <code>Service</code> 資源對象生成 <code>iptables</code> 或 <code>ipvs</code> 規則，進而擷取存取當前 <code>Service</code> 的 <code>ClusterIP</code> 的流量並將其轉發至正確的 <code>POD</code> 上。總而言之網路部分由它負責。</p><h3 id=container-runtime>Container-runtime</h3><ul><li>CRI<ul><li>抽象的，因為能運行的容器不只有 <code>Docker</code>，而每個容器的設計都不一樣。</li></ul></li><li>負責建立 container</li></ul><h2 id=其他>其他</h2><ul><li>CoreDNS<ul><li>用於服務發現和註冊的動態名稱解析服務</li></ul></li><li>Prometheus<ul><li>資源監控</li></ul></li><li>Ingress Controller<ul><li>負載均衡器，實現在第七層</li></ul></li></ul><h2 id=參考資料>參考資料</h2><ul><li><a href=https://kubernetes.io/docs/concepts/overview/what-is-kubernetes/>kubernetes 官網 what-is-kubernetes</a></li><li><a href=https://www.redhat.com/en/topics/containers/what-is-kubernetes>redhat what-is-kubernetes</a></li><li><a href=https://azure.microsoft.com/zh-tw/topic/what-is-kubernetes/#overview>微軟 what-is-kubernetes</a></li><li>書籍：Kubernetes进阶实战</li></ul></div><div class="d-flex flex-row justify-content-around"><h3 class="mb-1 mt-1 text-left mr-4"><a href=/kubernetes/2019-09-20-kubernetes/ title=kubernetes><i class="nav-menu fas fa-chevron-circle-left"></i></a></h3><h3 class="mb-1 mt-1 text-left ml-4"><a href=/kubernetes/2020-08-20-kubernetes-install/ title="kubernetes 1.18 安裝-day 02"><i class="nav-menu fas fa-chevron-circle-right"></i></a></h3></div></main><footer class="mt-2 mb-4 text-center"><span class=markdownify>short copyright message</span>
<span>&#183;
<i><a href=https://github.com/darshanbaral/aafu>aafu</a></i>
by
<a href=https://www.darshanbaral.com/>darshan</a></span></footer></body></html>