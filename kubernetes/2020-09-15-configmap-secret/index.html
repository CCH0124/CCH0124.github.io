<!doctype html><html lang=en-us style=max-width:1000px;margin:auto><head><title>Kevin Blog</title><meta name=theme-color content><meta charset=utf-8><meta content="width=device-width,initial-scale=1" name=viewport><meta name=description content="Kevin learning"><meta name=author content="Kevin Chen"><meta name=generator content="aafu theme by Darshan in Hugo 0.83.0"><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/safari-pinned-tab.svg color=#252627><link rel="shortcut icon" href=/favicon.ico><link rel=stylesheet href=/css/bootstrap/bootstrap.min.css><link rel=stylesheet href=https://use.fontawesome.com/releases/v5.15.2/css/all.css integrity=sha384-vSIIfh2YWi9wW0r9iZe7RJPrKwp6bG+s9QZMoITbCckVJqGCCRhc+ccxNcdpHuYu crossorigin=anonymous><link rel=stylesheet href=https://cdn.rawgit.com/jpswalsh/academicons/master/css/academicons.min.css><link rel=stylesheet href="//fonts.googleapis.com/css?family=Didact+Gothic%7CRoboto:400%7CRoboto+Mono"><link rel=stylesheet href=/css/aafu_pinkish.css><link rel=stylesheet href=/css/aafu.css><script>var themeColor=document.querySelector("meta[name=theme-color]");window.onload=()=>{themeColor.content=getComputedStyle(document.body)["background-color"];let a=document.querySelector(".accordion.active");a&&(a.nextElementSibling.style.maxHeight=a.nextElementSibling.scrollHeight+"px")},window.onresize=()=>{let a=document.querySelector(".accordion.active");a&&(a.nextElementSibling.style.maxHeight=a.nextElementSibling.scrollHeight+"px")}</script></head><body class=container><main style="min-height:calc(100vh - 60px)"><div class="d-flex flex-row row p-2"><h3 class="main-menu mr-3"><a href=https://cch0124.github.io/>Home</a></h3><h3 class="main-menu mr-3"><a href=/blog>Blog</a></h3><h3 class="main-menu mr-3"><a href=/project>Project</a></h3><h3 class="main-menu mr-3"><a href=/life>Life</a></h3><h3 class="main-menu mr-3"><a href=/kubernetes>Kubernetes</a></h3><h3 class="main-menu mr-3"><a href=/code>Coding</a></h3></div><div class=mb-3><h1 class=top-h1 style=font-size:2.75em>kubernetes - day25</h1><p class=mb-1>September 15, 2020</p><p>&mdash;</p></div><div class=content><p>這邊在大致說明 <code>ConfigMap</code> 和 <code>Secret</code>，它們也屬於 <code>volume</code> 的一種，前者通常是以配置的數據等為主；後者則是以密鑰等為主。為什麼說是 <code>volume</code> 的一種呢？透過掛載方式那些像是 TLS、SSL、CA 證書或一些配置可以與容器的 <code>image</code> 做到解偶。在傳統的 Docker 來說，一個容器中的應用程式不大可能使用預設配置，因此我們會透過<em>環境變數</em>或<em>卷(volume)</em> 等方式進行配置。在 K8s 上也利用 <code>ConfigMap</code> 和 <code>Secret</code> 完成一些容器所需的配置，透過這種方式也可避免被重新調度後導致配置內容遺失的問題。</p><h2 id=容器參數配置>容器參數配置</h2><p>透過 <code>explain</code> 方式，可以在容器等級字段中找到 <code>args</code>、<code>command</code> 的屬性，它們是用來定義容器要運行的指令(command)和傳遞參數(args)。<a href=https://kubernetes.io/docs/tasks/inject-data-application/define-command-argument-container/#running-a-command-in-a-shell>官方</a>也有說明，<code>command</code> 對應於 <code>Dockerfile</code> 中的 <code>ENTRYPOINT</code>；<code>args</code> 則對應於 <code>CMD</code>。</p><blockquote><p>The command field corresponds to entrypoint in some container runtimes. Refer to the Notes below.
The environment variable appears in parentheses, &ldquo;$(VAR)&rdquo;. This is required for the variable to be expanded in the command or args field.</p></blockquote><h2 id=容器環境變數配置>容器環境變數配置</h2><p>配置容器中檔案另一種方式就是利用環境變數傳值方式。在容器等級字段中有 <code>env</code> 的屬性，可以以 <code>List</code> 方式去定義很多的環境變數。透過 <code>explain</code> 查看後它由以下組成</p><ul><li>name<ul><li>環境變數的名稱</li></ul></li><li>value<ul><li>環境變數的值</li><li>可以使用 <code>$(NAME)</code> 引用定義過的環境變數名稱值</li><li><a href=https://kubernetes.io/docs/tasks/inject-data-application/define-interdependent-environment-variables/>官方範例</a></li></ul></li><li>valueFrom<ul><li>環境變數的值從哪邊引用，如 <code>PDO</code> 名稱或是從 <a href=https://kubernetes.io/docs/tasks/inject-data-application/podpreset/#pod-spec-with-configmap-example>ConfigMap</a> 和 <a href=https://kubernetes.io/docs/tasks/inject-data-application/distribute-credentials-secure/#define-container-environment-variables-using-secret-data>Secret</a> 引用</li><li>有 <code>value</code> 時 <code>valueFrom</code> 不能被定義，反過來也是</li></ul></li></ul><p>上面所提到容器如何寫入環境變數，但是容器這些不是能夠定義了嗎？為什麼還需要 <code>ConfigMap</code> 這些呢 ? 上面提到的方式無法為運行的容器即時更新環境變數，而 <code>ConfigMap</code> 可以解決此問題。</p><h2 id=configmap>ConfigMap</h2><p><code>ConfigMap</code> 增強了對 <code>POD</code> 環境設置的靈活性，其設置方式有透過 <code>volume</code> 或是 <code>valueFrom</code> 方式。<code>ConfigMap</code> 是屬於 <code>Map</code> 型態也就是以 Key-Value 進行定義，所以只要透過 <code>ConfigMap</code> 方式定義環境設置針對於相同的 <code>POD</code> 不同環境會有很大的靈活性。</p><h3 id=建立-configmap>建立 ConfigMap</h3><p>透過 <code>creat</code> 建立</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>$ kubectl create configmap test --from-literal<span style=color:#f92672>=</span>key1<span style=color:#f92672>=</span>value1 --from-literal<span style=color:#f92672>=</span>key2<span style=color:#f92672>=</span>value2 <span style=color:#75715e># test 是 ConfigMap 的名稱</span>
configmap/test created
</code></pre></div><p>查看 test 資源，當中 <code>data</code> 字段表示為定義的環境變數</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>$ kubectl get configmaps test -o yaml
apiVersion: v1
data:
  key1: value1
  key2: value2
kind: ConfigMap
metadata:
  creationTimestamp: <span style=color:#e6db74>&#34;2020-09-19T02:59:16Z&#34;</span>
  name: test
  namespace: default
  resourceVersion: <span style=color:#e6db74>&#34;7148417&#34;</span>
  selfLink: /api/v1/namespaces/default/configmaps/test
  uid: caddf30e-195b-45d2-9710-8cad2cab1e6c
</code></pre></div><p>假設是一個配置檔也可以使用檔案方式引入，可參考<a href=https://kubernetes.io/docs/tasks/configure-pod-container/configure-pod-configmap/#create-configmaps-from-files>官方</a>，該鏈接中許很多使用範例。</p><p>下面是以資源清單方式定義，同樣的要使用時用 <code>apply</code> 或其它方式布署。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>v1</span>
<span style=color:#f92672>kind</span>: <span style=color:#ae81ff>ConfigMap</span>
<span style=color:#f92672>metadata</span>:
  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>configmap-demo</span>
  <span style=color:#f92672>namespace</span>: <span style=color:#ae81ff>default</span>
<span style=color:#f92672>data</span>:
  <span style=color:#f92672>log_level</span>: <span style=color:#ae81ff>INFO</span>
  <span style=color:#f92672>log_file</span>: <span style=color:#ae81ff>/var/log/sys.log</span>
</code></pre></div><h3 id=configmap-傳遞變數至容器>ConfigMap 傳遞變數至容器</h3><p>我們使用上面建立的 test <code>ConfigMap</code> 進行實驗。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>v1</span>
<span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Pod</span>
<span style=color:#f92672>metadata</span>:
  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>configmap-demo</span>
  <span style=color:#f92672>namespace</span>: <span style=color:#ae81ff>default</span>
  <span style=color:#f92672>labels</span>:
    <span style=color:#f92672>app</span>: <span style=color:#ae81ff>myapp</span>
    <span style=color:#f92672>tier</span>: <span style=color:#ae81ff>test</span>
<span style=color:#f92672>spec</span>:
  <span style=color:#f92672>restartPolicy</span>: <span style=color:#ae81ff>Never</span>
  <span style=color:#f92672>containers</span>:
  - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>busybox</span>
    <span style=color:#f92672>image</span>: <span style=color:#ae81ff>busybox:latest</span>
    <span style=color:#f92672>command</span>: [<span style=color:#e6db74>&#34;/bin/sh&#34;</span>]
    <span style=color:#f92672>args</span>: [<span style=color:#e6db74>&#34;-c&#34;</span>, <span style=color:#e6db74>&#34;while true; do echo $(KEY1)$(KEY2); sleep 3600;done&#34;</span>]
    <span style=color:#f92672>env</span>:
    - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>KEY1</span>
      <span style=color:#f92672>valueFrom</span>:
        <span style=color:#f92672>configMapKeyRef</span>:
          <span style=color:#f92672>name</span>: <span style=color:#ae81ff>test</span>
          <span style=color:#f92672>key</span>: <span style=color:#ae81ff>key1</span>
    - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>KEY2</span>
      <span style=color:#f92672>valueFrom</span>:
        <span style=color:#f92672>configMapKeyRef</span>:
          <span style=color:#f92672>name</span>: <span style=color:#ae81ff>test</span>
          <span style=color:#f92672>key</span>: <span style=color:#ae81ff>key2</span>
</code></pre></div><p>透過以下方式驗證是否有成為環境變數。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>$ kubectl exec configmap-demo ps aux
kubectl exec <span style=color:#f92672>[</span>POD<span style=color:#f92672>]</span> <span style=color:#f92672>[</span>COMMAND<span style=color:#f92672>]</span> is DEPRECATED and will be removed in a future version. Use kubectl exec <span style=color:#f92672>[</span>POD<span style=color:#f92672>]</span> -- <span style=color:#f92672>[</span>COMMAND<span style=color:#f92672>]</span> instead.
PID   USER     TIME  COMMAND
    <span style=color:#ae81ff>1</span> root      0:00 /bin/sh -c <span style=color:#66d9ef>while</span> true; <span style=color:#66d9ef>do</span> echo value1value2; sleep 3600;<span style=color:#66d9ef>done</span> <span style=color:#75715e># value1value2 是我們定義的</span>
    <span style=color:#ae81ff>6</span> root      0:00 sleep <span style=color:#ae81ff>3600</span>
    <span style=color:#ae81ff>7</span> root      0:00 ps aux
$ kubectl exec configmap-demo printenv
kubectl exec <span style=color:#f92672>[</span>POD<span style=color:#f92672>]</span> <span style=color:#f92672>[</span>COMMAND<span style=color:#f92672>]</span> is DEPRECATED and will be removed in a future version. Use kubectl exec <span style=color:#f92672>[</span>POD<span style=color:#f92672>]</span> -- <span style=color:#f92672>[</span>COMMAND<span style=color:#f92672>]</span> instead.
PATH<span style=color:#f92672>=</span>/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
HOSTNAME<span style=color:#f92672>=</span>configmap-demo
KEY1<span style=color:#f92672>=</span>value1 <span style=color:#75715e># this</span>
KEY2<span style=color:#f92672>=</span>value2 <span style=color:#75715e># this</span>
</code></pre></div><p>這邊使用 <code>volumes</code> 方式，這邊以檔案方式建立 <code>ConfigMap</code></p><p>新增一個 nginx.www 檔案，內容如下</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>server <span style=color:#f92672>{</span>
        server_name cch.lab.com;
        listen 8080;
        root /data/web/html/;
<span style=color:#f92672>}</span>
</code></pre></div><p>透過 nginx.www 檔案產生一個 nginx-www 名稱的 <code>ConfigMap</code></p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>$ kubectl create configmap nginx-www --from-file<span style=color:#f92672>=</span>./configmap/nginx.www
configmap/nginx-www created
cchong0124@cloudshell:~ <span style=color:#f92672>(</span>sunny-catwalk-286908<span style=color:#f92672>)</span>$ kubectl get cm
NAME           DATA   AGE
nginx-config   <span style=color:#ae81ff>2</span>      6m
nginx-www      <span style=color:#ae81ff>1</span>      8s
$ kubectl get configmap nginx-www -o yaml <span style=color:#75715e># 取得 ConfigMap 資源訊息</span>
apiVersion: v1
data:
  nginx.www: <span style=color:#e6db74>&#34;server {\n\tserver_name cch.lab.com;\n\tlisten 8080; \n\troot /data/web/html/;\n}\n&#34;</span>
kind: ConfigMap
metadata:
  creationTimestamp: <span style=color:#e6db74>&#34;2020-08-28T00:02:42Z&#34;</span>
  name: nginx-www
  namespace: default
  resourceVersion: <span style=color:#e6db74>&#34;2803771&#34;</span>
  selfLink: /api/v1/namespaces/default/configmaps/nginx-www
  uid: 848af4cf-732f-4294-ae73-7d5fa75db3f9
</code></pre></div><p>以下是使用 <code>volumes</code> 的 <code>yaml</code> 檔</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>v1</span>
<span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Pod</span>
<span style=color:#f92672>metadata</span>:
  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>pod-cm</span>
  <span style=color:#f92672>namespace</span>: <span style=color:#ae81ff>default</span>
  <span style=color:#f92672>labels</span>:
    <span style=color:#f92672>app</span>: <span style=color:#ae81ff>myapp</span>
    <span style=color:#f92672>tier</span>: <span style=color:#ae81ff>frontend</span>
<span style=color:#f92672>spec</span>:
  <span style=color:#f92672>containers</span>:
  - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>myapp</span>
    <span style=color:#f92672>image</span>: <span style=color:#ae81ff>nginx:1.18</span>
    <span style=color:#f92672>ports</span>:
    - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>http</span>
      <span style=color:#f92672>containerPort</span>: <span style=color:#ae81ff>80</span>
    <span style=color:#f92672>volumeMounts</span>:
    - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>nginxconfig</span>
      <span style=color:#f92672>mountPath</span>: <span style=color:#ae81ff>/etc/nginx/config.d/</span>
      <span style=color:#f92672>readOnly</span>: <span style=color:#66d9ef>true</span>
  <span style=color:#f92672>volumes</span>:
  - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>nginxconfig</span>
    <span style=color:#f92672>configMap</span>:
      <span style=color:#f92672>name</span>: <span style=color:#ae81ff>nginx-config</span>
</code></pre></div><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>$ kubectl exec -it pod-cm -- /bin/sh
<span style=color:#75715e># cd /etc/nginx/config.d</span>
<span style=color:#75715e># ls</span>
nginx_host_name  nginx_port
<span style=color:#75715e># cat nginx_host_name</span>
cch.lab.com#
<span style=color:#75715e># cat nginx_port</span>
<span style=color:#ae81ff>8080</span>
</code></pre></div><p>用 <code>volume</code> 方式可以解決上個使用 <code>env</code> 的缺點，也就是可以對 <code>ConfigMap</code> 對象進行修改並映射到容器中，但過程中要通知 <code>API Server</code> 進行同步，因此需要一些時間。當中進入容器查看那些檔案，結果使用 <code>ls -al</code> 可以發現他是一個 <code>link</code>。</p><blockquote><p>ConfigMap 要比 POD 還要先建立否則會出現錯誤，除非使用 optional 字段。</p></blockquote><h2 id=secret>Secret</h2><p>用來存放敏感訊息，像是密碼、私鑰等，操作方式相似於 <code>ConfigMap</code>。它的內容是以編碼方式進行進行儲存，當在容器的環境數時將會自動解碼變成明文。</p><h3 id=建立-secret>建立 Secret</h3><p>同樣的使用 <code>create</code> 也能建立，其方式與 <code>ConfigMap</code> 差不多，也能使用檔案方式引用。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>$ kubectl create secret generic mysql-root-passwd --from-literal<span style=color:#f92672>=</span>pwd<span style=color:#f92672>=</span>itachi
secret/mysql-root-passwd created

$ kubectl get secret <span style=color:#75715e># 查看 secret 建立的資源</span>
NAME                  TYPE                                  DATA   AGE
default-token-gjdn4   kubernetes.io/service-account-token   <span style=color:#ae81ff>3</span>      8d
mysql-root-passwd     Opaque                                <span style=color:#ae81ff>1</span>      12s

$ kubectl describe secret mysql-root-passwd <span style=color:#75715e># 查看建立的 mysql-root-passwd </span>
Name:         mysql-root-passwd
Namespace:    default
Labels:       &lt;none&gt;
Annotations:  &lt;none&gt;

Type:  Opaque

Data <span style=color:#75715e># 不同於 ConfigMap 這邊部顯示數據</span>
<span style=color:#f92672>====</span>
pwd:  <span style=color:#ae81ff>6</span> bytes
</code></pre></div><p>相較於 <code>configmap</code> 在 <code>describe</code> 上 secret 不顯示數據。但用 <code>get</code> 方式並使用 <code>yaml</code> 輸出，則會顯示數據只不過 <code>secret</code> 將數據 <code>base64</code> 編碼</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>$ kubectl get secret mysql-root-passwd -o yaml
apiVersion: v1
data:
  pwd: aXRhY2hp
kind: Secret
metadata:
  creationTimestamp: <span style=color:#e6db74>&#34;2020-08-28T00:47:46Z&#34;</span>
  name: mysql-root-passwd
  namespace: default
  resourceVersion: <span style=color:#e6db74>&#34;2814321&#34;</span>
  selfLink: /api/v1/namespaces/default/secrets/mysql-root-passwd
  uid: 48cc0930-6005-449e-b035-87a2814abf02
type: Opaque
</code></pre></div><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>$ echo aXRhY2hp | base64 -d <span style=color:#75715e># 確實是 base64</span>
itachi
</code></pre></div><p>以資源清單方式建立</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>v1</span>
<span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Secret</span>
<span style=color:#f92672>metadata</span>:
  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>secret-demo</span>
<span style=color:#f92672>stringData</span>:
  <span style=color:#f92672>username</span>: <span style=color:#ae81ff>test</span>
  <span style=color:#f92672>password</span>: <span style=color:#ae81ff>passw0rd</span>
<span style=color:#f92672>type</span>: <span style=color:#ae81ff>Opaque</span>
</code></pre></div><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>$ kubectl get secret
NAME                  TYPE                                  DATA   AGE
default-token-nnghk   kubernetes.io/service-account-token   <span style=color:#ae81ff>3</span>      21d
mysql-root-passwd     Opaque                                <span style=color:#ae81ff>1</span>      19h
secret-demo           Opaque                                <span style=color:#ae81ff>2</span>      13s <span style=color:#75715e># this</span>
</code></pre></div><p>同樣的使用 <code>env</code> 方式進行引用，下面是一個 <code>yaml</code> 範例檔，<code>volume</code> 方式則不演示，用法語 <code>ConfigMap</code> 相同。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>v1</span>
<span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Pod</span>
<span style=color:#f92672>metadata</span>:
  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>pod-secret-1</span>
  <span style=color:#f92672>namespace</span>: <span style=color:#ae81ff>default</span>
  <span style=color:#f92672>labels</span>:
    <span style=color:#f92672>app</span>: <span style=color:#ae81ff>myapp</span>
    <span style=color:#f92672>tier</span>: <span style=color:#ae81ff>frontend</span>
<span style=color:#f92672>spec</span>:
  <span style=color:#f92672>containers</span>:
  - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>myapp</span>
    <span style=color:#f92672>image</span>: <span style=color:#ae81ff>nginx:1.18</span>
    <span style=color:#f92672>ports</span>:
    - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>http</span>
      <span style=color:#f92672>containerPort</span>: <span style=color:#ae81ff>80</span>
    <span style=color:#f92672>env</span>:
    - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>NGINX_SERVER_PORT</span>
      <span style=color:#f92672>valueFrom</span>:
        <span style=color:#f92672>configMapKeyRef</span>:
          <span style=color:#f92672>name</span>: <span style=color:#ae81ff>nginx-config</span>
          <span style=color:#f92672>key</span>: <span style=color:#ae81ff>nginx_port</span>
    - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>NGINX_SERVER_NAME</span>
      <span style=color:#f92672>valueFrom</span>:
        <span style=color:#f92672>configMapKeyRef</span>:
          <span style=color:#f92672>name</span>: <span style=color:#ae81ff>nginx-config</span>
          <span style=color:#f92672>key</span>: <span style=color:#ae81ff>nginx_host_name</span>
    - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>MYSQL_ROOT_PASSWD</span>
      <span style=color:#f92672>valueFrom</span>:
        <span style=color:#f92672>secretKeyRef</span>:
          <span style=color:#f92672>name</span>: <span style=color:#ae81ff>mysql-root-passwd</span>
          <span style=color:#f92672>key</span>: <span style=color:#ae81ff>pwd</span>
</code></pre></div><p>使用 <code>apply</code> 布署，接著查看有無引用至環境變數。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>$ kubectl exec pod-secret-1 -- printenv
PATH<span style=color:#f92672>=</span>/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
HOSTNAME<span style=color:#f92672>=</span>pod-secret-1
NGINX_SERVER_PORT<span style=color:#f92672>=</span><span style=color:#ae81ff>8090</span>
NGINX_SERVER_NAME<span style=color:#f92672>=</span>cch.lab.com
MYSQL_ROOT_PASSWD<span style=color:#f92672>=</span>itachi <span style=color:#75715e># this</span>
KUBERNETES_PORT_443_TCP<span style=color:#f92672>=</span>tcp://10.127.0.1:443
KUBERNETES_PORT_443_TCP_PROTO<span style=color:#f92672>=</span>tcp
KUBERNETES_PORT_443_TCP_PORT<span style=color:#f92672>=</span><span style=color:#ae81ff>443</span>
KUBERNETES_PORT_443_TCP_ADDR<span style=color:#f92672>=</span>10.127.0.1
KUBERNETES_SERVICE_HOST<span style=color:#f92672>=</span>10.127.0.1
KUBERNETES_SERVICE_PORT<span style=color:#f92672>=</span><span style=color:#ae81ff>443</span>
KUBERNETES_SERVICE_PORT_HTTPS<span style=color:#f92672>=</span><span style=color:#ae81ff>443</span>
KUBERNETES_PORT<span style=color:#f92672>=</span>tcp://10.127.0.1:443
NGINX_VERSION<span style=color:#f92672>=</span>1.18.0
NJS_VERSION<span style=color:#f92672>=</span>0.4.2
PKG_RELEASE<span style=color:#f92672>=</span>1~buster
HOME<span style=color:#f92672>=</span>/root
</code></pre></div><h2 id=參考資源>參考資源</h2><ul><li><a href=https://kubernetes.io/docs/tasks/inject-data-application/define-command-argument-container/#running-a-command-in-a-shell></a></li><li><a href=https://kubernetes.io/docs/tasks/inject-data-application/environment-variable-expose-pod-information/>環境變數 - 關於 POD 資訊注入</a></li></ul></div><div class="d-flex flex-row justify-content-around"><h3 class="mb-1 mt-1 text-left mr-4"><a href=/kubernetes/2020-09-14-volume-storage-class/ title="kubernetes - day24"><i class="nav-menu fas fa-chevron-circle-left"></i></a></h3><h3 class="mb-1 mt-1 text-left ml-4"><a href=/kubernetes/2020-09-16-statefulset/ title="kubernetes - day26"><i class="nav-menu fas fa-chevron-circle-right"></i></a></h3></div></main><footer class="mt-2 mb-4 text-center"><span class=markdownify>short copyright message</span>
<span>&#183;
<i><a href=https://github.com/darshanbaral/aafu>aafu</a></i>
by
<a href=https://www.darshanbaral.com/>darshan</a></span></footer></body></html>