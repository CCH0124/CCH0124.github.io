<!doctype html><html lang=en-us style=max-width:1000px;margin:auto><head><title>Kevin Blog</title><meta name=theme-color content><meta charset=utf-8><meta content="width=device-width,initial-scale=1" name=viewport><meta name=description content="Kevin learning"><meta name=author content="Kevin Chen"><meta name=generator content="aafu theme by Darshan in Hugo 0.83.0"><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/safari-pinned-tab.svg color=#252627><link rel="shortcut icon" href=/favicon.ico><link rel=stylesheet href=/css/bootstrap/bootstrap.min.css><link rel=stylesheet href=https://use.fontawesome.com/releases/v5.15.2/css/all.css integrity=sha384-vSIIfh2YWi9wW0r9iZe7RJPrKwp6bG+s9QZMoITbCckVJqGCCRhc+ccxNcdpHuYu crossorigin=anonymous><link rel=stylesheet href=https://cdn.rawgit.com/jpswalsh/academicons/master/css/academicons.min.css><link rel=stylesheet href="//fonts.googleapis.com/css?family=Didact+Gothic%7CRoboto:400%7CRoboto+Mono"><link rel=stylesheet href=/css/aafu_pinkish.css><link rel=stylesheet href=/css/aafu.css><script>var themeColor=document.querySelector("meta[name=theme-color]");window.onload=()=>{themeColor.content=getComputedStyle(document.body)["background-color"];let a=document.querySelector(".accordion.active");a&&(a.nextElementSibling.style.maxHeight=a.nextElementSibling.scrollHeight+"px")},window.onresize=()=>{let a=document.querySelector(".accordion.active");a&&(a.nextElementSibling.style.maxHeight=a.nextElementSibling.scrollHeight+"px")}</script></head><body class=container><main style="min-height:calc(100vh - 60px)"><div class="d-flex flex-row row p-2"><h3 class="main-menu mr-3"><a href=https://cch0124.github.io/>Home</a></h3><h3 class="main-menu mr-3"><a href=/blog>Blog</a></h3><h3 class="main-menu mr-3"><a href=/project>Project</a></h3><h3 class="main-menu mr-3"><a href=/life>Life</a></h3><h3 class="main-menu mr-3"><a href=/kubernetes>Kubernetes</a></h3><h3 class="main-menu mr-3"><a href=/code>Coding</a></h3></div><div class=mb-3><h1 class=top-h1 style=font-size:2.75em>DHCP 使用</h1><p class=mb-1>July 6, 2018</p><p>&mdash;</p></div><div class=content><h2 id=description>Description</h2><ul><li><code>DHCP (Dynamic Host Configuration Protocol)</code></li><li><code>Client</code> 連上 <code>DHCP Server</code> 後，<code>server</code> 會提供 <code>IP</code>、<code>gateway</code>、<code>DNS server</code> 給 <code>client</code>  </li><li><code>Clients request</code> 使用 UDP port 68</li><li><code>Server response</code> 使用 UDP port 67</li></ul><h2 id=environment>Environment</h2><p><em><strong>DHCP Server - Ubuntu 14.04</strong></em></p><ul><li>Network - Host-Only 網段 192.168.8.0</li></ul><p><em><strong>DHCP Clients - Ubuntu 14.04（test1） and Ubuntu 14.04（test2）</strong></em></p><ul><li>Netwok - 網卡設定（VMware）成跟 Server 一樣</li></ul><h2 id=installing-dhcp-in-dhcp-server>Installing DHCP in DHCP Server</h2><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=color:#f92672>[</span>itachi@ubuntu:~<span style=color:#f92672>]</span> sudo apt install isc-dhcp-server -y
</code></pre></div><h2 id=dhcp-server-setting>DHCP Server Setting</h2><h5 id=dhcp-接口>DHCP 接口</h5><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=color:#f92672>[</span>itachi@ubuntu:~<span style=color:#f92672>]</span> vi /etc/default/isc-dhcp-server
	INTERFACES<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;eth0&#34;</span> <span style=color:#75715e># 接口上提供DHCP請求，可以多個。</span>
</code></pre></div><h5 id=網路設定>網路設定</h5><p><code>DHCP Server</code> 設定 static Network</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=color:#f92672>[</span>itachi@ubuntu:~<span style=color:#f92672>]</span> vi /etc/network/interfaces
		iface eth0 inet static <span style=color:#75715e># 虛擬機預設是 DHCP ，更改成 Static IP</span>
		address 192.168.8.XX <span style=color:#75715e># 必須是 Host-only 網段上的 IP</span>
		netmask 255.255.255.0 <span style=color:#75715e># 遮罩</span>
		gateway 192.168.8.1 <span style=color:#75715e># 閘道</span>
		dns-nameservers 8.8.8.8 <span style=color:#75715e># dns</span>
</code></pre></div><h2 id=configuring-dhcp-in-dhcp-server>Configuring DHCP in DHCP Server</h2><h5 id=dhcp-configuration-file>DHCP configuration file</h5><p><code>/etc/dhcp/dhcpd.conf</code> # 設定一些資訊給DHCP Client 端</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=color:#f92672>[</span>itachi@ubuntu:~<span style=color:#f92672>]</span> vi /etc/dhcp/dhcpd.conf
	<span style=color:#75715e># 全域設定</span>
	ddns-update-style none;	<span style=color:#75715e># 支援 ddns (Dynamic DNS) 更新，IP</span>
				<span style=color:#75715e># 這個選項一定要存在才不會有錯誤。</span>

	option domain-name <span style=color:#e6db74>&#34;com.tw&#34;</span>; 	<span style=color:#75715e># 域名</span>
	option domain-name-servers ns1.com.tw, ns2.com.tw; <span style=color:#75715e># DNS</span>
	default-lease-time 3600; 	<span style=color:#75715e># 預設租期時間長度（秒）</span>
	max-lease-time 7200;		<span style=color:#75715e># 租期到可續租，但最大租期時間（秒）</span>
	authoritative; 			<span style=color:#75715e># DHCP Server 為本地網路，註解需拿掉</span>

	<span style=color:#75715e># 定義子網路</span>
	subnet 192.168.8.0 netmask 255.255.255.0 <span style=color:#f92672>{</span>  	<span style=color:#75715e># network</span>
		range 192.168.8.200 192.168.8.254; 	<span style=color:#75715e># Range</span>
		option domain-name-servers 192.168.8.1, 8.8.8.8; <span style=color:#75715e># Pri DNS , Sec DNS</span>
		option domain-name <span style=color:#e6db74>&#34;com.tw&#34;</span>; 		<span style=color:#75715e># Domain name</span>
		option routers 192.168.8.1; 		<span style=color:#75715e># Gateway</span>
		option broadcast-address 192.168.8.255; <span style=color:#75715e># Broadcast</span>
	<span style=color:#f92672>}</span>
	
	<span style=color:#75715e># 針對特定服務或裝置給定 IP</span>
	host ubuntu <span style=color:#f92672>{</span> <span style=color:#75715e>#名稱隨意，最好是對方hostname</span>
		hardware ethernet 00:f0:m4:6y:89:0g; 	<span style=color:#75715e># 對方的 MAC</span>
		fixed-address 192.168.8.210; 		<span style=color:#75715e># 固定從 range 給定此 IP</span>
	<span style=color:#f92672>}</span>
</code></pre></div><h2 id=service-start>Service start</h2><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>  sudo service isc-dhcp-server start  
  sudo service isc-dhcp-server stop  
  sudo service isc-dhcp-server restart
</code></pre></div><h2 id=test>test</h2><p><strong>Client</strong></p><p>test1：192.168.8.200<br>test1：192.168.8.201</p><p><strong>Server</strong></p><p>DHCP Server：192.168.8.60
<code>DHCP Server</code> 檢查是否分配</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=color:#f92672>[</span>itachi@ubuntu:~<span style=color:#f92672>]</span> sudo tail /var/lib/dhcp/dhcpd.leases
</code></pre></div></div><div class="d-flex flex-row justify-content-around"><h3 class="mb-1 mt-1 text-left mr-4"><a href=/project/2018-07-05-apache/ title="Apache 使用"><i class="nav-menu fas fa-chevron-circle-left"></i></a></h3><h3 class="mb-1 mt-1 text-left ml-4"><a href=/project/2018-07-18-rsyslog/ title="rsyslog 應用"><i class="nav-menu fas fa-chevron-circle-right"></i></a></h3></div></main><footer class="mt-2 mb-4 text-center"><span class=markdownify>short copyright message</span>
<span>&#183;
<i><a href=https://github.com/darshanbaral/aafu>aafu</a></i>
by
<a href=https://www.darshanbaral.com/>darshan</a></span></footer></body></html>